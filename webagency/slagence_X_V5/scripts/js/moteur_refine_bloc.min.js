var divcontent=$("#recherche-listing"),noqry="",eachAnnonce="";function clearAll(e){$(".hidden-annlistepg").val(""),$("#MiniInputBudgetMin").val("Min"),$("#MiniInputBudgetMax").val("Max"),$("#MiniSelectBudget").val("Max"),$("#MiniInputSurfaceMin").val("Min"),$("#MiniInputSurfaceMax").val("Max"),$("#MiniInputSurfaceTerrainMin").val("Min"),$("#MiniInputSurfaceTerrainMax").val("Max"),$("#MiniSelectSurface").val(""),$(".auto-create-hidden").val(""),1===e&&(1==$("#moteurRefine").val()?($("#idqInput").val(""),$("#idpaysInput").val(""),$("#cpInput").val(""),$("#divInput").val(""),$("#ciInput").val("")):($(".hidden-ci").val(""),$(".hidden-idq").val(""))),$("#cpVilles").val(""),$(".hidden-cp").val(""),$(".ville-suggest-liste").html(""),$("#rayon").val("")}function hideAll(){$(".conteneur-checkbox").children(".display-show").each(function(){$(this).removeClass("display-show"),$(this).parent("").find(".minus").addClass("display-none"),$(this).parent("").find(".plus").removeClass("display-none")})}function triloyer(e){1==e||3==e||7==e?($(".px-croissant").val("a_px_loyer"),$(".px-decroissant").val("d_px_loyer")):4==e?($(".px-croissant").val("a_px_bs_semaine"),$(".px-decroissant").val("d_px_bs_semaine")):($(".px-croissant").val("a_px"),$(".px-decroissant").val("d_px"))}function champshidden(e){if(null==(i=e.attr("data-name"))){var i=e.attr("data-name");if(null==$(".hidden-"+i).val()&&$("#Mini_Moteur").append('<input type="hidden" value="" name="'+i+'" class="hidden-'+i+' auto-create-hidden" />'),$(".hidden-"+i).val(""),e.hasClass("choix-selection-refine")){var n=e.attr("data-value");$(".hidden-"+i).val(n)}}else null==$(".hidden-"+i).val()&&$("#Mini_Moteur").append('<input type="hidden" value="" name="'+i+'" class="hidden-'+i+' auto-create-hidden" />'),$(".hidden-"+i).val(""),"idvpa"==i?$(".refineIdpva").each(function(){if($(this).hasClass("choix-selection-refine")){var e=$(".hidden-"+i).val();0<e.length&&(e+=",");var n=$(this).attr("data-value");$(".hidden-"+i).val(e+n)}}):e.parent("div").children(".choix-selection-refine").each(function(){var e=$(".hidden-"+i).val();0<e.length&&(e+=",");var n=$(this).attr("data-value");$(".hidden-"+i).val(e+n)})}function serializemoteur(){var i={};return $("#Mini_Moteur input,select").filter(function(){var e=$(this).prop("name"),n=$(this).val();return e?(i[e]||(i[e]=[]),-1===i[e].indexOf(n)?(i[e].push(n),n):void 0):n}).serialize()}function scrollFix(e){if(winW<768)var n=$("#recherche-resultats-listing").offset();else if(0<$(".phrase-recherche").offset())n=$(".phrase-recherche").offset();else if(0<$(".bloc-top-alerte-email".length))n=$(".bloc-top-alerte-email").offset();else n=$(".creer-alerte-email").offset();if(1==e)return $("html, body").animate({scrollTop:n.top},600),!1}function loadville(e){$.ajax({type:"GET",dataType:"html",cache:!1,data:e,url:"/moteur,suggest,incl_get_localisation_ajax.htm",success:function(e){$(".ville-suggest-liste").html(""),$(".ville-suggest-liste").html(e)}})}function reloadSearch(){var e=window.location;if(""!=(i=e.hash.split("#"))){var n=i[1],i=n.split("&");for($('input[class*="hidden-"]').each(function(){"hidden-pres"!=$(this).attr("class")&&"hidden-idtt"!=$(this).attr("class")&&$(this).val("")}),l=0;l<i.length;l++){var a=i[l].split("=");if("tri"!=a[0]&&"lang"!=a[0]&&"idqfix"!=a[0]&&"expiree"!=a[0]){if(a[1]){var t=a[1].replace("%2b","+");if("idtt"===a[0])triloyer(t);if("Min"!=t&&"Max"!=t)if(1==$("#moteurRefine").val())"ci"==a[0]?$("#ciInput").val(a[1]):"cp"==a[0]?$("#cpInput").val(a[1]):"idq"==a[0]?$("#idqInput").val(a[1]):"idpays"==a[0]?$("#idpaysInput").val(a[1]):"div"==a[0]?$("#divInput").val(t):null!=$(".hidden-"+a[0]).val()?$(".hidden-"+a[0]).val(t):"pxmax"!=a[0]&&"pxmin"!=a[0]&&"surfacemax"!=a[0]&&"surfacemin"!=a[0]&&"surf_terrainmin"!=a[0]&&"surf_terrainmax"!=a[0]&&"pxbtw"!=a[0]&&"saisie"!=a[0]?($("#Mini_Moteur").append('<input type="hidden" value="" name="'+a[0]+'" class="hidden-'+a[0]+' auto-create-hidden" />'),$(".hidden-"+a[0]).val(t)):($('input[name="'+a[0]+'"]').val(t),$('select[name="'+a[0]+'"]').children("option").each(function(){$(this).val()==decodeURIComponent(t)&&$(this).attr("selected","selected")}));else if(null!=$(".hidden-"+a[0]).val()&&""!=$(".hidden-"+a[0]).val())$(".hidden-"+a[0]).val(t);else if("pxmax"!=a[0]&&"pxmin"!=a[0]&&"surfacemax"!=a[0]&&"surfacemin"!=a[0]&&"surf_terrainmin"!=a[0]&&"surf_terrainmax"!=a[0]&&"pxbtw"!=a[0]&&"cp"!=a[0]){t=t.replace("%2f","/");$("#Mini_Moteur").append('<input type="hidden" value="" name="'+a[0]+'" class="hidden-'+a[0]+' auto-create-hidden" />'),$(".hidden-"+a[0]).val(t),$("#"+a[0]+"Dept").children("option").each(function(){var e=$(this).val();-1<decodeURIComponent(t).indexOf(e)&&($(this).attr("selected","selected"),"cp"==a[0]&&($(this).trigger("change"),setTimeout(function(){checkCity(hashCi)},1e3))),"ci"!=a[0]&&$(".hidden-"+a[0]).val("")}),"ci"==a[0]&&(hashCi=a[1])}else $('input[name="'+a[0]+'"]').val(t)}}else if("tri"==a[0]){$(".hidden-tri").val(a[1]);var s=a[1];$("#trierRefine").find("option").each(function(){$(this).val()==s&&$(this).attr("selected",!0)})}}n.indexOf("ci=")<0&&$("#ciInput").val(""),null!=n&&(loadInfos(),scrollFix(0)),loadville(n)}else{if(""!=(i=e.search.split("?")))i[1].split("&");nbpanier()}}function checkCity(e){$("#ciDept").children("option").each(function(){-1<e.indexOf($(this).val())&&$(this).attr("selected","selected")})}function openList(){$(".liste-checkbox").each(function(){if($(this).hasClass("refine-transac")||$(this).hasClass("input-text")){if($(this).hasClass("input-text")){var n=0;$(this).find("input").each(function(){if(n++,"Min"!=$(this).val()&&"Max"!=$(this).val()&&""!=$(this).val()&&"1"!=e){$(this).parent("div").parent("div").parent("div").parent("div").parent("div").parent("div").addClass("display-show"),$(this).parent("div").parent("div").parent("div").parent("div").parent("div").parent("div").parent("div").find(".minus").removeClass("display-none"),$(this).parent("div").parent("div").parent("div").parent("div").parent("div").parent("div").parent("div").find(".plus").addClass("display-none");var e="1"}else{2!=n&&($(this).parent("div").parent("div").parent("div").parent("div").parent("div").parent("div").removeClass("display-show").addClass("display-none"),$(this).parent("div").parent("div").parent("div").parent("div").parent("div").parent("div").parent("div").find(".minus").addClass("display-none"),$(this).parent("div").parent("div").parent("div").parent("div").parent("div").parent("div").parent("div").find(".plus").removeClass("display-none"));e="0"}})}}else"0"!=$(this).find("."+btnaction).length&&($("#recherche-moteur").hasClass("moteurFlat")||($(this).parent("div").parent("div").addClass("display-show"),$(this).parent("div").parent("div").parent("div").children(".titre-section-refine").find(".minus").removeClass("display-none"),$(this).parent("div").parent("div").parent("div").children(".titre-section-refine").find(".plus").addClass("display-none")))})}function selectVille(){if(""!=(e=window.location.hash.split("#"))){var e=e[1].split("&");for(i=0;i<e.length;i++){var n=e[i].split("=");if("ci"==n[0]){var a=n[1];if(7<a.length){var t=a.split(","),s=t.length;for(i=0;i<s;i++)$("#cpVilles").children("option").each(function(){$(this).context.value==t[i]&&$(this).attr("selected",!0)})}else $("#cpVilles").children("option").each(function(){$(this).context.value==a&&$(this).attr("selected",!0)})}}}}function usePagination(i){$("#recherche-listing").on("click",".pagination a, .pagination div:not(.pagination-ignore)",function(e){e.preventDefault();var n=$(this).html();0<$(".pagination-ignore",this).length&&(n=$("div:not(.pagination-ignore)",this).html()),$(".hidden-annlistepg").length<1&&$("#Mini_Moteur").append('<input type="hidden" value="" name="ANNLISTEpg" class="hidden-annlistepg auto-create-hidden" />'),"&lt;&lt;"==n?$(".hidden-annlistepg").val("1"):"&gt;&gt;"==n?$(".hidden-annlistepg").val(i):"&gt;"==n?$(".hidden-annlistepg").val(parseInt($(".page-courante").html())+1):"&lt;"==n?$(".hidden-annlistepg").val(parseInt($(".page-courante").html())-1):$(".hidden-annlistepg").val(n),$(".hidden-tri").val(""),loadInfos(),scrollFix(1)})}function changeBudget(e){1==e||3==e||7==e?($("#MiniInputBudgetMin").attr("name","px_loyermin"),$("#MiniInputBudgetMax").attr("name","px_loyermax")):4==e?($("#MiniInputBudgetMin").attr("name","px_bs_semainemin"),$("#MiniInputBudgetMax").attr("name","px_bs_semainemax")):($("#MiniInputBudgetMin").attr("name","pxmin"),$("#MiniInputBudgetMax").attr("name","pxmax"))}function nbpanier(){$.ajax({type:"GET",data:"&ti="+(new Date).getTime(),cache:!1,dataType:"json",contentType:"application/json",url:"/moteur,refine,incl_nbpanier.js",success:function(e){var i=e.idselected,a=e.nbpanier;if(0!=parseInt(a)){var t=i.length;for(n=0;n<t;n++)fixStar(i[n].idann)}countSelection(a)},error:function(e,n,i){},complete:function(e,n){}})}function loadListe(e,n){$("#ciInput").val(n);var i=document.getElementsByName("pres");$(i).val("basic"),loadInfos()}function loadInfos(){if("#expiree"!=location.hash){$(".text-opti-ref").html(""),$(".saisie-suggest").val("");var e=serializemoteur(),l=$(".hidden-pres").val();$.ajax({type:"GET",data:e+"&ti="+(new Date).getTime(),cache:!1,dataType:"json",contentType:"application/json",url:"/moteur,refine,incl_refine_js.js",beforeSend:function(){$(".layer").show(),$(".layer-annonce").show(),$(".layer").addClass("display-show").removeClass("display-none"),$(".layer-annonce").addClass("display-show").removeClass("display-none"),hideAll()},success:function(e){location.hash=e.qry;var n=$(".bloc-prase-nb").children(".nb-annonces").clone();if(n.html(e.nbphrase),$(".phrase-recherche").html(e.phrase),$(".phrase-recherche-input"),$(".phrase-recherche-input").val(e.phrase),$(".bloc-prase-nb").html(""),n.outerHTML()&&$(".bloc-prase-nb").append(n.outerHTML()),$("input[name='qry']").val(e.qry),$("input[name='phrase']").val(e.phrase),$("input[name='page_base']").val(lienAlerte+"?"+e.qry),zeroquery=e.zeroquery,$("#cpVilles").trigger("liszt:updated"),""!=e.idtt&&($(".hidden-idtt").val(e.idtt),$(".refine-transac").parent().children(".titre-section-refine").find(".span11").html(e.transac),$(".refineIdtt").each(function(){$(this).attr("data-idtt")==e.idtt?($(this).addClass(btnaction+" typo-white").removeClass(btnneutre),$(this).find(".json-check").removeClass("display-none").addClass("display-show")):($(this).addClass(btnneutre).removeClass(btnaction+" typo-white"),$(this).find(".json-check").addClass("display-none").removeClass("display-show"))}),changeBudget(e.idtt)),""!=e.idvpa){var a=e.idvpa.split(","),t=a.length;$(".refineIdpva").addClass(btnneutre).removeClass(btnaction+" typo-white"),$(".refineIdpva").find(".json-check").addClass("display-none"),$(".refineIdpva").each(function(){for(i=0;i<t;i++)$(this).attr("data-value")==a[i]&&($(this).addClass(btnaction+" typo-white").removeClass(btnneutre),$(this).find(".json-check").removeClass("display-none").addClass("display-show"))})}triloyer(e.idtt);var s=e.tri;""!=s&&$(".hidden-tri").val(s),$("#trierRefine").find("option").each(function(){$(this).val()==s&&$(this).attr("selected",!0)}),window.top.document.title=$(".phrase-recherche").text(),"carto"===l&&reloadMap()},error:function(e,n,i){divcontent.html('<div class="pagination-centered"><img src="/z/webagency/slagence_X_V5/images/carto/ajax-loader.gif" alt="loader" /></div><div class="pagination-centered h2-like">LOADING</div>'),$(".layer").removeClass("display-show").addClass("display-none"),$(".layer-annonce").removeClass("display-show").addClass("display-none")},complete:function(e,n){}});$.ajax({type:"GET",dataType:"html",cache:!1,data:e,url:"/recherche,incl_moteur_ajax.htm",success:function(e){$(".loaded-moteur").remove(),$(".last-before-load").nextAll(".conteneur-checkbox").remove(),$(".last-before-load").after(e)},error:function(e,n,i){$(".layer").removeClass("display-show").addClass("display-none"),$(".layer-annonce").removeClass("display-show").addClass("display-none")},complete:function(e,n){}}),$.ajax({type:"GET",dataType:"html",cache:!1,data:e,url:"/recherche,incl_moteur_typebien_ajax.htm",success:function(e){$(".typebien-refine").html(""),$(".typebien-refine").html(e)},error:function(e,n,i){$(".layer").removeClass("display-show").addClass("display-none"),$(".layer-annonce").removeClass("display-show").addClass("display-none")},complete:function(e,n){}}),"carto"!=l?($("#recherche-carto").addClass("display-none"),$.ajax({type:"GET",dataType:"html",cache:!1,data:e,url:"/recherche,incl_recherche_"+l+"_ajax.htm",success:function(e){divcontent.html(e)},error:function(e,n,i){},complete:function(e,n){$(".saisie-suggest").val($(".saisie-suggest").attr("data-value")),$(".refine-page").children("a").each(function(){$(this).attr("href","#")}),$(".btn-tooltip").tooltip(),winW<767&&$("#Mini_Moteur").hide(),$("#content-moteur").find(".choix-selection-refine").each(function(){champshidden($(this))}),$(".layer").hide(),$(".layer-annonce").hide(),$(".layer").addClass("display-none").removeClass("display-show"),$(".layer-annonce").addClass("display-none").removeClass("display-show"),1==isEpsa&&(checkAnnonces(),ifLog())}})):(reloadMap(),$.ajax({type:"GET",dataType:"html",cache:!1,data:e,url:"/recherche,incl_fil_rouge_refine.htm",beforeSend:function(){$(".fil-rouge").html("")},success:function(e){$(".fil-rouge").html(e)}})),nbpanier(),hideAll(),loadville(e)}else location.hash=""}function reloadMap(){$(".saisie-suggest").val($(".saisie-suggest").attr("data-value")),$(".refine-page").children("a").each(function(){$(this).attr("href","#")}),$(".btn-tooltip").tooltip(),winW<767&&$("#Mini_Moteur").hide(),$("#content-moteur").find(".choix-selection-refine").each(function(){champshidden($(this))}),$(".layer").hide(),$(".layer-annonce").hide(),$(".layer").addClass("display-none").removeClass("display-show"),$(".layer-annonce").addClass("display-none").removeClass("display-show"),1==isEpsa&&(checkAnnonces(),ifLog()),initMap(function(e){initHandlers(e),lassoHandler(e)}),$("#recherche-carto").removeClass("display-none"),$("#recherche-resultats-listing-content").addClass("display-none")}function switchNamePx(e,n,i){var a=e,t=a.id;a.value==a[a.length-1].value?$("#"+t).attr("name",n):$("#"+t).attr("name",i)}$(document).ready(function(){if(pxbtw){var e=pxbtw.split("/"),n=e[0],i=e[1];$(".prix-min").val(n),$(".prix-max").val(i)}"0"!=$(".hidden-idtt").val()&&(reloadSearch(),$("#cpVilles").trigger("liszt:updated")),usePagination(maxpage),$(".refine-page").children("a").each(function(){var e=$(this).attr("href").split("?")[0];$(this).attr("href",e)}),$("#recherche-listing, #recherche-carto").on("click",".bouton-change-affichage",function(){var e=$(this).attr("data-pres");$(".hidden-pres").val(e),"carto"!=e?($("#recherche-carto").addClass("display-none"),$("#recherche-resultats-listing-content").removeClass("display-none"),loadInfos(),scrollFix(1)):($(".bloc-btn-change-affichage").children("div").each(function(){if(($(this).hasClass("btn-action")||$(this).hasClass("btn-action-no-gradient"))&&($(this).removeClass("btn-action").removeClass("btn-action-no-gradient"),$(this).removeClass("bouton-change-location","bouton-change-vente","bouton-change-loc-temp","bouton-change-loc-vac","bouton-change-viager","bouton-change-invest","bouton-change-loc-prest","bouton-change-vente-prest","bouton-change-neuf","bouton-change-fdc","bouton-change-cession"),$(this).addClass("bouton-change-affichage").addClass("btn-neutre"),$(this).children().is("img"))){var e=$(this).children("img").attr("src");if(-1<e.indexOf("black")){var n=e.replace("_black","");$(this).children("img").attr("src",n)}else{n=e.replace(".png","_black.png");$(this).children("img").attr("src",n)}}}),$('.bouton-change-affichage[data-pres="carto"]').each(function(){$(this).addClass("btn-action").removeClass("btn-neutre"),$(this).children("i").addClass("typo-white").removeClass("typo-black")}),loadInfos(),scrollFix(1),$("#recherche-resultats-listing-content").addClass("display-none"),reloadMap())}),$("#recherche-moteur").on("focusin",".moteur-input-change",function(e){_getValue=$(this).attr("data-placeholder"),$(this).val(""),$(this).on("focusout",function(){""==$(this).val()&&$(this).val(_getValue)})}),$("#recherche-moteur").on("click",".ligne",function(){if($(this).hasClass("refineIdtt")){var e=$(this).attr("data-idtt");$(".hidden-idtt").val(e),triloyer(e),$(".refineIdtt").addClass(btnneutre).removeClass(btnaction+" typo-white"),$(".refineIdtt").find(".json-check").removeClass("display-show").addClass("display-none"),$(this).addClass(btnaction+" typo-white").removeClass(btnneutre),$(this).find(".json-check").addClass("display-show"),clearAll(0),$(".choix-selection-refine").each(function(){$(this).hasClass("refineIdtt")||($(this).addClass("choix-neutre-refine"),$(this).removeClass("choix-selection-refine","typo-white"),$(this).find(".json-check").removeClass("display-show").addClass("display-none"))}),changeBudget(e)}else{if($(this).hasClass("refineIdpva"))if($(this).hasClass(btnneutre))$(this).parent("div").children("div").removeClass(btnaction+" typo-white").addClass(btnneutre),$(this).parent("div").children("div").find(".json-check").removeClass("display-show"),$(this).find(".json-check").addClass("display-show"),$(this).addClass(btnaction+" typo-white").removeClass(btnneutre),champshidden($(this));else $(this).parent("div").children("div").find(".json-check").removeClass("display-show").addClass("display-none"),$(this).addClass(btnneutre).removeClass(btnaction+" typo-white"),champshidden($(this));else if($(this).hasClass(btnneutre))$(this).find(".json-check").addClass("display-show"),$(this).addClass(btnaction+" typo-white").removeClass(btnneutre),champshidden($(this));else $(this).find(".json-check").removeClass("display-show"),$(this).addClass(btnneutre).removeClass(btnaction+" typo-white"),champshidden($(this))}$(".hidden-annlistepg").remove()}),$("#recherche-moteur").on("change","#cpVilles",function(){$(".hidden-ci").val($("#cpVilles").val()),$(".hidden-polygon").val("")}),$("#recherche-moteur").on("change","#cpDept",function(){$(".hidden-ci").val(""),$(".hidden-cp").val($("#cp").val()),$(".hidden-polygon").val("")}),$("#recherche-moteur").on("change","#ciDept",function(){$(".hidden-ci").val(""),$(".hidden-polygon").val("")}),$("#recherche-listing").on("change","#trierRefine",function(){$(".hidden-annlistepg").val(""),$(".hidden-tri").val(""),$(".moteur-all").find($("#form-tri")).remove(),0<$(".hidden-tri").length?$(".hidden-tri").val($(this).val()):$("#Mini_Moteur").append('<input type="hidden" value="" name="tri" class="hidden-tri auto-create-hidden" />'),loadInfos(),scrollFix(1)}),$("#Mini_Moteur, #recherche-listing").on("click",".bouton-raz",function(e){if(e.preventDefault(),"undefined");else zeroquery;clearAll(1),loadInfos(),scrollFix(1)});var a="1";if($("#recherche-moteur").on("click",".bouton-rechercher-refine, .bouton-rechercher-moteur",function(e){e.preventDefault(),null!=$("myMapContainer")&&0!=$("myMapContainer").length?a.SetSearch(serializemoteur()):($(".hidden-annlistepg").val(""),$(".hidden-surfacemin").val(""),$(".hidden-surfacemax").val(""),$(".breadcrumb").parent("div").html(""),loadInfos())}),1==typeLocalite){var t,s=$(".ville-libre").closest(".conteneur-checkbox").find(".bouton-rechercher-refine").html(),l=$(".ville-libre").closest(".conteneur-checkbox").find(".bouton-rechercher-refine").attr("data-loading-text");$(".ville-libre").on("keydown",function(e){t}),$(".ville-libre").on("keyup",function(e){$(this).val();var n="ville="+$(this).val()+"&idtt="+$(".hidden-idtt").val(),t=$(this);$.ajax({type:"GET",dataType:"json",cache:!1,data:n,url:"/moteur,refine,incl_preval_ville_libre.htm",beforeSend:function(){t.closest(".conteneur-checkbox").find(".bouton-rechercher-refine").html(l)},success:function(e){var n=e.villes.length,i=e.villesActive;if(0<n){for($(".hidden-ci").val(""),v=0;v<n;v++)if(-1<i.indexOf(e.villes[v].villeCi)){if(0<(a=$(".hidden-ci").val()).length)var a=$(".hidden-ci").val()+",";$(".hidden-ci").val(a+e.villes[v].villeCi)}}else $(".hidden-ci").val(""),$(".hidden-ci").val(e.villes[0].villeCi);t.closest(".conteneur-checkbox").find(".bouton-rechercher-refine").html(s)},complete:function(){}})})}$("#recherche-moteur").on("click",".titre-section-refine",function(){var e=$(this).parent("div").children(".display-none");e.hasClass("display-none")&&(e.hasClass("display-show")?(hideAll(),e.removeClass("display-show"),$(this).find(".minus").addClass("display-none"),$(this).find(".plus").removeClass("display-none")):(hideAll(),e.addClass("display-show"),$(this).find(".minus").removeClass("display-none"),$(this).find(".plus").addClass("display-none")))}),$("#recherche-listing").on("click",".remove-filter",function(){var e=$(this).attr("data-qry");$("select[name='"+e+"']").each(function(){$(this).val("")}),$("input[name='"+e+"']").each(function(){"ci"==e&&$(".line-suggest-selected").remove(),$(this).val("")}),loadInfos(),scrollFix(1)})}),jQuery.fn.outerHTML=function(e){return e?this.before(e).remove():$("<p>").append(this.eq(0).clone()).html()};