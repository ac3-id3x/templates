function launchBingMap(){layerPoi=new MM.Layer({zIndex:50}),layerPoi.setZIndex(50),pinInfobox=new MM.Infobox(new Microsoft.Maps.Location(0,0),{visible:!1}),pinAnnonce=null,winW>=tailleW?GetDetailMap(arrayAnnonce,"100%",400,1):GetDetailMap(arrayAnnonce,"100%",250,1),$("[class*='poi-family-']").on("click",function(){hidePinFamily($(this).attr("id"))})}function GetDetailMap(e,n,i,t){if(i<=250)var o=!0;startMap.empty(),map=new MM.Map(document.getElementById("map_poi"),{mapTypeId:MM.MapTypeId.road,credentials:MyBingMapsCredentials,isRotationEnabled:!0,enableClickableLogo:!1,enableSearchLogo:!1,showCopyright:!1,showDashboard:!0,showMapTypeSelector:!1,fixedMapPosition:!0,disablePanning:o,useInertia:!1,showLogo:!1,zoom:zoomPoi,width:n,height:i}),MM.Events.addThrottledHandler(map,"viewchangeend",initPoi,1),map.setView({center:new MM.Location(e[0].latitude,e[0].longitude),zoom:zoomPoi}),1==t&&MM.Events.addHandler(map,"dblclick",DoubleClick),MM.Events.addHandler(map,"viewchange",hideInfobox)}function DoubleClick(e){e.handled=!0}function displayInfobox(e){var n=e.target.getLocation(),i=new MM.Location(n.latitude,n.longitude);pinInfobox.setLocation(i),pinInfobox.setOptions({title:e.target.Title,visible:!0,offset:new Microsoft.Maps.Point(-3,32),maxHeight:60,zIndex:100}),pinInfobox.setMap(map)}function hideInfobox(e){pinInfobox.setOptions({visible:!1})}function hidePinFamily(e){for(var n,i=layerPoi.getLength(),t=0;t<i;t++)(n=layerPoi.get(t)).Id===e&&(!0===n.getVisible()?n.setOptions({visible:!1}):n.setOptions({visible:!0}))}function initPoi(){var i={entityId:[],config:{key:"c2ae584bbccc4916a0acf75d1e6947b4",pois:[{filter:"EntityTypeID eq '4013'",top:10,icon:"/z/webagency/slagence_X_V5/images/poi/train-station.png"},{filter:"EntityTypeID eq '4170'",top:10,icon:"/z/webagency/slagence_X_V5/images/poi/bus-station.png"},{filter:"EntityTypeID eq '5400'",top:10,icon:"/z/webagency/slagence_X_V5/images/poi/grocery-store.png"},{filter:"EntityTypeID eq '5800'",top:10,icon:"/z/webagency/slagence_X_V5/images/poi/restaurant.png"},{filter:"EntityTypeID eq '6512'",top:10,icon:"/z/webagency/slagence_X_V5/images/poi/shopping.png"},{filter:"EntityTypeID eq '7832'",top:10,icon:"/z/webagency/slagence_X_V5/images/poi/cinema.png"},{filter:"EntityTypeID eq '7947'",top:10,icon:"/z/webagency/slagence_X_V5/images/poi/park.png"},{filter:"EntityTypeID eq '8200'",top:10,icon:"/z/webagency/slagence_X_V5/images/poi/higher-education.png"},{filter:"EntityTypeID eq '8211'",top:10,icon:"/z/webagency/slagence_X_V5/images/poi/school.png"},{filter:"EntityTypeID eq '8231'",top:10,icon:"/z/webagency/slagence_X_V5/images/poi/library.png"},{filter:"EntityTypeID eq '9121'",top:10,icon:"/z/webagency/slagence_X_V5/images/poi/city-hall.png"},{filter:"EntityTypeID eq '9530'",top:10,icon:"/z/webagency/slagence_X_V5/images/poi/post-office.png"},{filter:"EntityTypeID eq '9532'",top:10,icon:"/z/webagency/slagence_X_V5/images/poi/bar.png"},{filter:"EntityTypeID eq '9545'",top:10,icon:"/z/webagency/slagence_X_V5/images/poi/department-store.png"},{filter:"EntityTypeID eq '9565'",top:10,icon:"/z/webagency/slagence_X_V5/images/poi/pharmacy.png"}]},loader:function(e,n){return $('[class*="poi-family-"]').addClass("display-none"),$.ajax({url:"https://spatial.virtualearth.net/REST/v1/data/"+i.config.key+"/NavteqEU/NavteqPOIs?",dataType:"jsonp",data:e,jsonp:"jsonp",success:function(e){e.d.results.forEach(function(e){pinAnnonce=new MM.Pushpin(new MM.Location(e.Latitude,e.Longitude),{icon:n,height:45,width:35}),pinAnnonce.Title=e.Name,pinAnnonce.Id=e.EntityTypeID,MM.Events.addHandler(pinAnnonce,"click",displayInfobox),layerName=e.EntityTypeID,-1===i.entityId.indexOf(e.EntityTypeID)&&(i.entityId.push(e.EntityTypeID),i.show(e.EntityTypeID)),layerPoi.add(pinAnnonce)})}})},show:function(e){$(".poi-family-"+e).removeClass("display-none")},init:function(){i.entityId=[];var e=map.getBounds(),n="bbox("+e.getSouth()+","+e.getWest()+","+e.getNorth()+","+e.getEast()+")";layerPoi.clear(),i.config.pois.forEach(function(e){i.loader({key:MyBingMapsCredentials,$format:"json",spatialFilter:n,$filter:e.filter,$top:e.top||10},e.icon)}),map.layers.insert(layerPoi)}};i.init()}arrayAnnonce.push({latitude:detailAnnGeo.lat,longitude:detailAnnGeo.lon});