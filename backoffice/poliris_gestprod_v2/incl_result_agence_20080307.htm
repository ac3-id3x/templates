$$REM$$
====================================================================
//// <summary>Menu pour le module de recherche client  - Résultat</summary>
//// <remarks>
//// <para>Pages html inclues : incl_legende.htm, incl_pages.htm</para>
//// <para>Rep:1 - N° du dossier</para>
//// <para>Liste des macros B utilisées dans cette page (sans &dollar;&dollar;) : LECTURE_DOSSIER_AGENCE alias LSTDOSAG </para>
//// </remarks>
//// <update date="2007-12-27" author="ext-jean-jacques.durmord">Création</update>
=====================================================================
$$END:REM$$
$$E:AUTH:VERIFICATION$$
$$B:GDP2:LECTURE_DOSSIER_AGENCE:~ID:REP:1:ALIAS:LSTDOSAG$$

	$$IF:GDP2:MAJ_PUBLICATION:ERRMSG$$
		<p class="erreur" >Message d'erreur : $$GDP2:MAJ_PUBLICATION:ERRMSG$$</p>
	$$END$$

	<form id="frmenregistrement" name="frmenregistrement" method="post"  >
		<input type="hidden" id="u" name="u" value="GDP2:MAJ_PUBLICATION">
		<input type="hidden" id="page_ok" name="page_ok" value="/$$REP:1$$/dossier.htm">
		<input type="hidden" id="page_err" name="page_err" value="$$REP:URI$$">
		<input type="hidden" id="iddossier" name="iddossier" value="$$REP:1$$">
		<input type="hidden" id="chselection" name="chselection" value="0" >
		<input type="hidden" id="type" name="type" value="1">
		<h1>Recherche Agence</h1> 
		<div  class="cadrefonce" >
		<center>
			&nbsp;

			<table width="95%"  >
					<!-- Legende -->
					<tr >
						<th></th>

						<th>
							Publication
						</th>
						<th>
							Nom de l'agence
						</th>
						<th>
							Publication
						</th>
					</tr>
					$$BIF:LSTDOSAG$$
						
						$$DO:1:15$$
							<tr>
								<td class="$$LSTDOSAG:I mod2 td_alt td_alt1$$" >
									<input type="checkbox" name="chselection" id="chselection" value="$$LSTDOSAG:IDPUBLICATION$$" />
									<!--	onchange="javascript:validate($$LSTDOSAG:IDPUBLICATION$$);"-->
								</td>
								<td class="$$LSTDOSAG:I mod2 td_alt td_alt1$$" >$$LSTDOSAG:IDPUBLICATION ucase$$</td>
								<td class="$$LSTDOSAG:I mod2 td_alt td_alt1$$" >$$LSTDOSAG:NOM$$</td>
								<td class="$$LSTDOSAG:I mod2 td_alt td_alt1$$" >$$LSTDOSAG:PUBLICATION$$
									<INPUT id="TYPPUB$$LSTDOSAG:IDPUBLICATION$$" 
										name="TYPPUB$$LSTDOSAG:IDPUBLICATION$$" type="hidden" 
										value="$$LSTDOSAG:IDTYPEPUBLICATION$$">
								</td>
							</tr>
						$$LOOP$$
					$$BFIN$$	
					
			</table>						
			$$INCL:PAGES.HTM$$
			<a href="/$$REP:1$$/dossier_recherche_agence.htm" class="Aorange" >Recherche</a>
			<input type="button" value="Ajouter une publication" onclick="javascript:addPublication();" />
		 	<p align="right"><input type="reset" value="Annuler" />&nbsp;
		 		<input type="button" value="Fermer" onclick="javascript:self.close();" />
		 	</p>
			</center>
			&nbsp;
	</div>
</form>
<script>
function addPublication()
{
	var myForm = document.getElementById('frmenregistrement');
	var elt_u = document.getElementById('u');
	var elt_chselection = document.getElementById('chselection');
	var elt_type = document.getElementById('type');
//	var elt_iddossier = document.getElementById('iddossier');
	
	
	// Le formulaire est-il présent ?
	if(myForm)
	{
		// A-t-on une balise u ? 
		if (elt_u)
		{
			if(elt_chselection) {
				elt_chselection.value = addListId('checkbox', 'chselection');
			}
			
			if( (elt_chselection.value != 0) && (elt_type.value != '') )
			{
				myParams = buildParams('&', 'u', 'page_ok', 'page_err', 'chselection', 'type', 'iddossier' );
				validateFormOnSuccess('', 'incl_result_agence.htm' ,myParams);
				
			} else { alert('Impossible de récupérer les publications. Veuillez séléctionner les publications à ajouter.\n\nSi le problème persiste, contactez le service informatique de gestion'); return 0; }
		}
	}
	
	
		/*frmVal.chselection.value = addListId('checkbox', 'chselection');
		frmVal.actif.value = "1";
		frmVal.submit();*/
	
	
}
	
function validate(chselection)
{
	var frmVal = getopener().document.frmliaisonagence;
	//alert(eval("document.frmenregistrement.chselection"+chselection+".checked == true"));
	if (frmVal.iddossier.value == '$$REP:1$$')
	{
		frmVal.chselection.value = chselection ;
		frmVal.type.value = "1" ;
		if (eval("document.frmenregistrement.chselection"+chselection+".checked == true"))
		{
			frmVal.actif.value = "1";
		}
		else
		{
			frmVal.actif.value = "2";
		}
		frmVal.submit();
	}
	else
	{
		alert("La fenêtre n'est plus synchronisée");
		self.close();
	}
	
}
</script>