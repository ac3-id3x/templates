$$SET:PAGE:TITRE=Modification du type annonce$$ 
$$A:CAT=annonce_edit$$
$$E:AUTH:CHECK_LOGIN:~authrequiredlevel:LOOSE$$
$$INCL:HAUT.HTM$$ 

<!-- $$REP:SRV$$ //-->

<script type="text/javascript">
<!--
	$$IF=:www.selogerpro.com:REP:SRV$$
		id3_go('/index.htm');
	$$END$$
//-->
</script>


<!--$$REP:1$$-->
$$E:SLPRO:ANNONCE:REP:1$$

$$E:IMMOBC:TESTWAG:@@AUTH:CHECK_LOGIN:IDAGENCE$$
$$B:IMMOBC:TYPESTRANSACTION$$
$$B:IMMOBC:TYPESBIEN$$
$$B:IMMOBC:TYPESACTIVITE:ANN:VAL:IMMOBC_ANNONCE_IDANNONCE$$

$$IF:ERRE$$
	<div class="erre"><span>$$ERRE$$</span></div>
$$END$$

<div id="disptabstc" style="width:0px; height:0px;"></div>
<script type="text/javascript" language="javascript"><!--
var stcvide = '<font class="errmsg">Vous devez sélectionner un Type de Commerce</font>';
var stcvide2 = '';
var stc = buildArray();

	
function skipmsg(namecookie){
	EcrireCookie("skipmsg"+namecookie,"1");
	var info_agorabiz = document.getElementById('info_agorabiz');
	info_agorabiz.style.display = 'none';	
}	
	
	
function restictbcom(v){
		var btnvalider_choix = document.getElementById("btnvalider_choix");
		var info_agorabiz = document.getElementById('info_agorabiz');
		if(btnvalider_choix) btnvalider_choix.style.display = 'inline';
		if(info_agorabiz) info_agorabiz.style.display = 'none';
		if((v == 6)||(v == 7)||(v == 8)||(v == 11)||(v == 12)){
		//	btnvalider_choix.style.display = 'none';
			info_agorabiz.style.display = 'block';	
			initSize();	
		}
}	


function geschoixedit(v) {
	var objidtt = document.getElementById("idtypetransaction");
	var objidtb = document.getElementById("idtypebien");
	var temptype = document.getElementById("temptype");
	var btnvalider_choix = document.getElementById("btnvalider_choix");
	var info_agorabiz = document.getElementById('info_agorabiz');
	if(btnvalider_choix) btnvalider_choix.style.display = 'inline';
	if(info_agorabiz) info_agorabiz.style.display = 'none';
	if(objidtb) {
		objidtb.disabled = '';
		objidtb.selectedIndex = 0;
		}
	
	if((v == 9)||(v == 10)){
		temptype.name = "idtypebien";
		objidtb.disabled = 'disabled';


		if(v == 9){
			r = 15; 
			temptype.value = "15";
		}
		
		if(v == 10){
			r = 6; 
			temptype.value = "6";
			
		//		btnvalider_choix.style.display = 'none';
				info_agorabiz.style.display = 'block';
				initSize();
		
		}
		
		for(i=0; i<objidtb.length; i++) {
			if (objidtb.options[i].value == r) {
				objidtb.selectedIndex = i;
				break;
			}
		}
		
	}else{
		if(v == 11){
		
			//	btnvalider_choix.style.display = 'none';
				info_agorabiz.style.display = 'block';
				initSize();
			//	objidtb.disabled = 'disabled';
			
		}
		
		if(temptype) temptype.name= "temptype";
	}
}



function NeufSelect_2008(t){
	//select_if( t, '9', '15' );
	if( t == 1 ) {
		select_if( 1, '10', '6' );
	}
}

function select_if(t, idtt, idtb) {
	var i;
	var objidtb = MM_findObj( "idtypebien");
	var objidtt = MM_findObj( "idtypetransaction");
	var btnvalider_choix = document.getElementById("btnvalider_choix");
	var info_agorabiz = document.getElementById('info_agorabiz');
	if(btnvalider_choix) btnvalider_choix.style.display = 'inline';
	if(info_agorabiz) info_agorabiz.style.display = 'none';
	

		alert(idtt);
		if((idtt == 10)||(idtt == 11)){
			btnvalider_choix.style.display = 'none';
			info_agorabiz.style.display = 'block';
			initSize();
		}

	
	if ((t == 1) && (objidtt.value == idtt)) {
		for(i=0; i<objidtb.length; i++) {
			if (objidtb.options[i].value == idtb) {
				objidtb.selectedIndex = i;
				
				break;
			}
		}
	}
	else if ((t == 2) && (document.f_types.idtypebien.value == idtb)) {
		for(i=0; i<objidtt.length; i++) {
			if (objidtt.options[i].value == idtt) {
				objidtt.selectedIndex = i;
				break;
			}
		}
	}
}

function CheckTbTt() {
	var objtt=MM_findObj("idtypetransaction");
	var objtb=MM_findObj("idtypebien");
	var objForm = MM_findObj("newann");
	var errmsg = "";
	if (objtt.value == "") {errmsg = "vous devez sélectionner le type de transaction\n";}
	if (objtb.value == "") {errmsg += "vous devez sélectionner le type de bien\n";}

	if (errmsg != "") {
		alert("Pour pouvoir créer une annonce\n" + errmsg);
		return false;
	}else {
		return true;
	}
}	


function valid(){
var objForm = MM_findObj( "f_types" );
var objidtt = MM_findObj( "idtypetransaction");
var objlistcom = MM_findObj( "list_commerces");
	if (objidtt.value == 10 && objlistcom.value == ""){
		alert("Attention, vous devez saisir une activité pour ce fond de commerce");
	}
	else {
		var conf = confirm('ATTENTION, changer le type de l\'annonce peut entrainer la perte du contenu de certains champs.\nEtes-vous sûr de vouloir continuer ?');
		if (conf == true) {objForm.submit();}
	}
}

function CheckTransaction()
{
var objIdtt = MM_findObj( "idtypetransaction" );
var objIdtc = MM_findObj( "idtypecommerce" );
var objListC = MM_findObj( "list_commerces" );
	if (objIdtt.value != 10) {
		if(objIdtc) {objIdtc.disabled='true';}
 		FillLayer('disptabstc', stcvide2);
		if(objListC){
			objListC.value='';} 
	} 
	else {
		objListC.value='';
		objListC.disabled='';
		DispSousTypesCommerces();
	} 
}

function DispSousTypesCommerces()
{
var objIdtc = MM_findObj( "idtypecommerce" );
	if (objIdtc) {
		if (objIdtc.value != '')
			FillLayer('disptabstc', stc[objIdtc.value]);
		else
			FillLayer('disptabstc', stcvide);
		checkBoxes();
	}
}

function buildArray()
{
	// $$FORM:IDSOUSTYPECOMMERCE$$
	var a, i;
	$$B:IMMOBC:SOUSTYPESCOMMERCES$$$$BIF:IMMOBC:SOUSTYPESCOMMERCES$$
	a = new Array(64);
	for(i=0; i<a.length; i++) a[i] = '<table width="500" border="0" cellspacing="0" cellpadding="0"><tr><td>';
	$$DO:1:999$$
	a[$$IMMOBC:SOUSTYPESCOMMERCES:IDTYPECOMMERCE$$] += '<input type="checkbox" name="idsoustypecommerce" value="$$IMMOBC:SOUSTYPESCOMMERCES:IDSOUSTYPECOMMERCE$$" $$IF(:IMMOBC_SOUSTYPESCOMMERCES_IDSOUSTYPECOMMERCE:FORM:IDSOUSTYPECOMMERCE$$checked="checked"$$END$$ />&nbsp;$$IMMOBC:SOUSTYPESCOMMERCES:SOUSTYPECOMMERCE sp2nbsp escape$$\r\n';$$LOOP$$
	for(i=0; i<a.length; i++) a[i] += '</td></tr></table>';
	$$BFIN$$
	return a;
}

function modify_commerce() {
	var elt_ca = MM_findObj( "commerces_annonces" );
	var objIdtt = MM_findObj( "idtypetransaction" );
	if(objIdtt.value==10)
	{
		var url = '/$$SLPRO:ANNONCE:IDANNONCE$$/$$SLPRO:ANNONCE:IDAGENCE$$/p_commerces_edit.htm';
		if( elt_ca ) {
			if( elt_ca.value != "" ) {
				url += "?commerces_annonces=" + escape( elt_ca.value );
			}
		}
		PopUP(url,'Commerces',450,500,window.screen.Height/2 - 200,window.screen.Width/2 - 225,'yes','yes');
	}
	else
	{
		alert('Vous ne pouvez avoir d\'activité que pour les "Ventes fond de commerce"');
	}
}
function store( ids, txt ) {
	var elt_ca = MM_findObj( "commerces_annonces" );
	if( elt_ca ) {
		elt_ca.value = ids;
	}
	elt_ca = MM_findObj( "list_commerces" );
	if( elt_ca ) {
		elt_ca.value = txt;
	}
}

function checkBoxes()
{
var objIdtc = MM_findObj( "idtypecommerce" );
	if ('$$SLPRO:ANNONCE:IDTYPECOMMERCE$$' == objIdtc.value)
	{
		var i;
		var soustypecommerce = $$SLPRO:ANNONCE:SOUSTYPECOMMERCE$$$$IF0:SLPRO:ANNONCE:SOUSTYPECOMMERCE$$0$$END$$;
		if (document.f_types.idsoustypecommerce)
		{
			for(i=0; i<document.f_types.idsoustypecommerce.length; i++)
			{
				if ((soustypecommerce & document.f_types.idsoustypecommerce[i].value) == document.f_types.idsoustypecommerce[i].value)
				{
					document.f_types.idsoustypecommerce[i].checked = true;
				}
			}
		}
	}
}

function initchoixann(){
	var objidtt = document.getElementById("idtypetransaction");
	if(objidtt){objidtt.selectedIndex = 0;}
	var objidtb = document.getElementById("idtypebien");
	if(objidtb){
		objidtb.selectedIndex = 0;
		objidtb.disabled = '';
	}
}


	
		$j(document).ready(function() {
			initchoixann;
		});		




// --></script>




<table class="tabbasic" cellpadding="0" cellspacing="0">
	<tr><td class="tabentete" colspan="2">Modification du type de bien / type de transaction d'une annonce</td></tr>
	<tr><td>

<form action="annonce_changetypeok.htm" method="post" name="f_types" onsubmit="return CheckTbTt();">
<input type="hidden" name="page_ok" value="/$$REP:1$$/annonce_changetypeok.htm">
<input type="hidden" name="page_err" value="annonce_changetype.htm">
<input type="hidden" name="idannonce" value="$$SLPRO:ANNONCE:IDANNONCE$$">
<input type="hidden" name="temptype" id="temptype" value="1" />
<input type="hidden" name="idagence" value="$$SLPRO:ANNONCE:IDAGENCE$$$$IF0:SLPRO:ANNONCE:IDAGENCE$$$$FORM:IDAGENCE$$$$END$$">
<input type="hidden" name="u" value="immobc:agence_annoncechangetype">


			$$BIF:IMMOBC:TYPESTRANSACTION$$
			Type de transaction<br />
			<select name="idtypetransaction" id="idtypetransaction" onchange="$$REM$$$$IF0:MODEDEV$$CheckTransaction();$$END$$$$END$$geschoixedit(this.options[this.selectedIndex].value);">
			<option value="">Type de transaction</option>
			$$DO:1:999$$ 
				$$A:TTAFFICH=0$$
				$$IF!:7:IMMOBC:TYPESTRANSACTION:IDTYPETRANSACTION$$
					
					$$IF:IMMOBC:TESTWAG:SI_WAG$$
						$$A:TTAFFICH=1$$
					$$END:SI_WAG$$
					
					$$IF0:IMMOBC:TESTWAG:SI_WAG$$
						$$IF!:9:IMMOBC:TYPESTRANSACTION:IDTYPETRANSACTION$$
							$$A:TTAFFICH=1$$
						$$END:IDTYPETRANSACTION$$
					$$END:SI_WAG$$
					
				$$END:3$$
			$$IF=:1:TTAFFICH$$
				<option value="$$IMMOBC:TYPESTRANSACTION:IDTYPETRANSACTION$$"$$IF=:IMMOBC_ANNONCE_IDTYPETRANSACTION:IMMOBC:TYPESTRANSACTION:IDTYPETRANSACTION$$ selected="selected"$$END$$>$$IMMOBC:TYPESTRANSACTION:TYPETRANSACTION mcase$$</option>
			$$END$$
			
			$$LOOP$$
			</select>$$BFIN$$
		</td><td>
			$$BIF:IMMOBC:TYPESBIEN$$
			Type de biDen<br />
			<select name="idtypebien" id="idtypebien" onChange="NeufSelect_2008(2);restictbcom(this.options[this.selectedIndex].value);">
				<option value="">Type de bien</option>
			$$DO:1:999$$  
				$$A:TBAFFICH=0$$
				
				$$IF:IMMOBC:TESTWAG:SI_WAG$$
					$$A:TBAFFICH=1$$
				$$END:SI_WAG$$
				
				$$IF0:IMMOBC:TESTWAG:SI_WAG$$
					$$IF!:15:IMMOBC:TYPESBIEN:IDTYPEBIEN$$
						$$A:TBAFFICH=1$$
					$$END:IDTYPEBIEN$$
				$$END:SI_WAG$$
				
				$$IF=:1:TBAFFICH$$
				<option value="$$IMMOBC:TYPESBIEN:IDTYPEBIEN$$"$$IF=:IMMOBC_ANNONCE_IDTYPEBIEN:IMMOBC:TYPESBIEN:IDTYPEBIEN$$ selected="selected"$$END$$>$$IMMOBC:TYPESBIEN:TYPEBIEN mcase$$</option>
				$$END$$
				
			$$LOOP$$
			</select>
			$$BFIN$$
			
		</td>
	</tr>

$$REM$$$$IF0:MODEDEV$$	<tr>
		<td valign="top" colspan="2"><b>Vente fond de commerce</b></td>
	</tr>

	<tr>
		<td>Activités</td>
		<td align="left"><a href="javascript:modify_commerce();">Ajouter / modifier une activité</a></td>
	</tr>
	<tr>
		<td valign="top" colspan="2">
			<input type="hidden" name="with_commerces" value="$$WITH_COMMERCES$$" /><!-- $$FORM:WITH_COMMERCES$$ -->
			<input type="hidden" name="commerces_annonces" id="commerces_annonces" value="$$IF0:FORM:WITH_COMMERCES$$$$IF:SLPRO:ANNONCE:IDANNONCE$$$$BIF:IMMOBC:TYPESACTIVITE:ANN$$$$DO:1:999$$$$IF>:2:IMMOBC:TYPESACTIVITE:ANN:I$$,$$END$$$$IMMOBC:TYPESACTIVITE:ANN:IDTYPEACTIVITE$$$$LOOP$$$$BFIN$$$$END:SLPRO:ANNONCE:IDANNONCE$$$$END:FORM:WITH_COMMERCES$$$$IF:FORM:WITH_COMMERCES$$$$FORM:COMMERCES_ANNONCES$$$$END:FORM:WITH_COMMERCES$$" />
			<textarea cols="50" name="list_commerces" id="list_commerces" readonly="readonly" onclick="javascript:modify_commerce();">$$IF0:FORM:WITH_COMMERCES$$$$IF:SLPRO:ANNONCE:IDANNONCE$$$$BIF:IMMOBC:TYPESACTIVITE:ANN$$$$DO:1:999$$$$IF>:2:IMMOBC:TYPESACTIVITE:ANN:I$$,$$END$$$$IMMOBC:TYPESACTIVITE:ANN:SOUSTYPECOMMERCE$$$$LOOP$$$$BFIN$$$$END:SLPRO:ANNONCE:IDANNONCE$$$$END:FORM:WITH_COMMERCES$$$$IF:FORM:WITH_COMMERCES$$$$FORM:LIST_COMMERCES$$$$END:FORM:WITH_COMMERCES$$</textarea>
		</td>
	</tr>
	<tr>
		<td align="left" colspan="2"><input type="hidden" name="soustypecommerce" value="" /></td>
	</tr>$$END$$$$END$$

</table>




	$$A:VALSKIPBXAB=_editanntype$$
	<div id="info_agorabiz">
		<div id="info_agorabiz_cookie">
			$$INCL:BX_AB.HTM$$
		</div>
	</div>


<div id="line_btn_ann">
	<div class="btn_left">
	<div onclick="javascript:id3_go('$$ID3DOM$$/$$REP:1$$/annonce_edit.htm');"><img src="$$_$$i/dyn/btnrerturnedition.png"  /></div>
	</div>
	<div class="btn_right">
		<input type="image" src="$$_$$i/dyn/btnmodifier.png" id="btnvalider_choix" $$REM$$onclick="$$IF0:MODEDEV$$valid();$$END$$"$$END$$ />
	</div>
</div>




</form>
$$REM$$$$IF0:MODEDEV$$
<script type="text/javascript" language="javascript"><!--
CheckTransaction();
var objstc = MM_findObj( "soustypecommerce" );
objstc.value=0;
// --></script>
$$END$$$$END$$

<script type="text/javascript">
<!--
	var skipmsg_editann = LireCookie("skipmsg_editanntype");	
	var info_agorabiz_cookie = document.getElementById('info_agorabiz_cookie');
	if(skipmsg_editann == "1"){
		if(info_agorabiz_cookie){info_agorabiz_cookie.style.display = "none";}
	}
//-->
</script>

$$INCL:BAS.HTM$$