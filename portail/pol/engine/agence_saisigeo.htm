$$A:GMAP=1$$
$$DYN:ID3:NOCACHE:FULL$$
$$A:GMKEY=ABQIAAAAxGi6UAETf3q68PMcXqKFXhQV3BEbCAyAHd3qENbYhD7z5MCJEBTU2jTDVstunHtTYeY31cgE5SZJSw$$
$$IF:XDEV$$
$$A:GMKEY=ABQIAAAAxGi6UAETf3q68PMcXqKFXhR2JiSPLUESL7mO862X3PySvBVExRTLHwSlkZlhGhJ_qexbF19JuaC1UA$$
$$END$$
$$A:NOBACKLINKS=1$$
$$SET:TAGNAME=@@E3:CAT:TAGNAME@@$$
$$DYN:AUTH:CHECK_LOGIN:~authrequiredlevel:LOOSE$$
$$E:SLPRO:INFOSAGENCE$$
<html xmlns:v="urn:schemas-microsoft-com:vml" ><head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<META NAME="MSSmartTagsPreventParsing" content="TRUE">
<script type="text/javascript" language="javascript" SRC="$$_$$sl.js"></SCRIPT>
<link rel="stylesheet" type="text/css" href="$$_$$st1.css" media="all">
<link rel="stylesheet" type="text/css" href="$$_$$annonce.css" media="all">
<style>
*#header {
background-image: url('http://www.seloger.com/z/portail/sv5/images/bgBleuL.gif');
background-repeat: repeat-x;
height:40px;
width:auto;
}

*#tout {
margin-top:4px;
border:0px solid black;
width: auto;
/*background-color:#E6E6D8;*/
background-color:none;
}

#mapcontainer {
border:1px solid #aaa;
background-color:#fff;
padding:4px;
margin: 4px 2px 2px 2px;
}

#map {
border:1px solid #aaa;
}

#quartieraff {
border:1px solid #aaa;
background-color:#fff;
padding:4px;
margin: 4px 2px 2px 2px;
}
</style>

	<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=$$GMKEY$$&hl=fr"
      type="text/javascript"></script>
</head>
	

<body $$IF:GMAP$$onload="initMap()" onunload="GUnload()"$$END$$  $$IF:GMAP$$scroll=no$$END$$ bgcolor="#FFFFFF" leftmargin="0" topmargin="0"  LINK="#000000" ALINK="#000000" VLINK="#000000" TEXT="#000000">

<div id=mapcontainer>
	
	<div id="map" style="width: 100%; height: 600px"></div>	
	<script type="text/javascript">

	// Declaration des variables qui vont servir a stocker les lat et lng:
	var currentMarker=null;     
		// la carte sur laquelle on dessine
	var map ;
		// latitude et longitude du centre de la carte
	var latitude=46.2267;
	var longitude=2.20912;
	var zoom = 6;
	var isgeoloc = false;
		$$IF:FORM:LAT$$
			isgeoloc = true;
			latitude=$$FORM:LAT replace , . $$;
			longitude=$$FORM:LNG replace , . $$;		
			zoom = 15;	
		$$END$$
		$$E:E3:GETLATLNGFORCP:~cp:QRY:CP:ALIAS:GETLATLNGFORCP$$
		$$IF0:FORM:LAT$$
			$$IF:GETLATLNGFORCP:LAT$$			
				latitude=$$GETLATLNGFORCP:LAT replace , . $$;				
				longitude=$$GETLATLNGFORCP:LNG replace , . $$;			
				zoom=14;		
			$$END$$
		$$END$$
	//icon pour affichage normal
	var icon = new GIcon();
	icon.image = "http://www.google.com/mapfiles/marker.png";
	icon.iconBasiqueize = new GSize(20, 34);
	icon.iconAnchor = new GPoint(9, 34);
	icon.infoWindowAnchor = new GPoint(9, 2);
						
			
	 function initMap() {
	 	 var evenement = null;
      if (GBrowserIsCompatible()) {      	
      			// Declaration des variables
   	
      	 	
         
        map = new GMap2(document.getElementById("map"));
        map.addControl(new GLargeMapControl());
        map.addControl(new GMapTypeControl());
				map.addControl(new GOverviewMapControl());

				map.setCenter(new GLatLng(latitude,longitude), zoom);
			
				if(isgeoloc)
				{
					currentMarker = new GMarker(new GLatLng(latitude,longitude),{draggable:true})
					map.addOverlay(currentMarker);
				}
				// click sur la carte, debut ou fin d'un segment
				GEvent.addListener(map, "click", function(marker, point) {  														
					if(marker instanceof GMarker) ;						
					else
					{	
						if(currentMarker!=null) map.removeOverlay(currentMarker);			
						currentMarker = new GMarker(new GLatLng(point.lat(),point.lng()),{draggable:true})									
						map.addOverlay(currentMarker);
					}
				});
																			
 					window.focus();
      }
    }
    
    function updateLatLng() {
    	if(currentMarker != null)
    	{
				document.forms["f_geolocagence"].lat.value = currentMarker.getPoint().lat();
				document.forms["f_geolocagence"].lng.value = currentMarker.getPoint().lng();
				document.forms["f_geolocagence"].Submit;						
				alert('Votre nouvelle position a été enregistrée avec succès');
			}
			self.close();
		}

  </Script>
  </div>
  <div>
  <form method="post" name="f_geolocagence">	
  	<input type="hidden" name="page_ok" value="/$$REP:0$$" />	
		<input type="hidden" name="page_err" value="/$$REP:0$$" />			
		<input type="hidden" name="u" value="SLPRO:UPDATE-GEOLOC-AGENCE" />
		<input type="hidden" name="lat" value="" />
		<input type="hidden" name="lng" value="" />
  <table width="100%">
  	<tr>
  		<td align="left">
  		<span class="btn" align="right">
				<input type="image" name="Submit" src="$$_$$i/dyn/btnvalider.png" onclick="updateLatLng();"/>
			</span>
			<td>
						
  		<td align="right">
			<span class="btn" align="left">
				<input type="image" name="Submit" src="$$_$$i/dyn/btnannuler.png" onclick="self.close();" />
			</span>
		</td>
	</table>
	</form>
  </div>

  </body>

</html>