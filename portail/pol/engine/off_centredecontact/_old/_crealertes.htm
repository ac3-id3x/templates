$$E:E3:CAT:CDC_NRECHERCHE:SLPRO$$
$$INIT:FORM:COURONNERAYON=1$$
$$SET:PAGE:IDT=MandatventeCrealertes$$
$$INIT:FORM:DISPLAY=compte$$ 
$$INIT:INTRAX=1$$ 
$$DYN:AUTH:CHECK_LOGIN:~authrequiredlevel:LOOSE$$
<!--#include absolute="/portail/pol/engine/centredecontact/haut.htm"-->

$$IF:MANDATVENTE:CLIENT:PRIME_RESTANT$$	$$IF!:compte:FORM:DISPLAY$$
	<div style="border:1px outset #42638C; color:#42638C; font-weight:bold; float:center; padding:3px; margin-bottom:10px; width:350px;">
		<a href="javascript:void(0);" class="mvhelp" onmouseover="return escape(dcc2(this,'$$LG:PRIME escape$$'));"><img src="$$_$$engine/centredecontact/icons/lightbulb.gif" /></a> &nbsp; Offre découverte : Profitez encore de $$MANDATVENTE:CLIENT:PRIME_RESTANT formatnumber 0$$&euro; HT
	</div>
$$END$$	$$END$$

$$E:MANDATVENTE:CLIENT$$
$$B:MANDATVENTE:BIENS:ALIAS:BIENS$$
$$B:MANDATVENTE:TRANSACTIONS:ALIAS:TRANSACTIONS$$

<style type="text/css">
<!--
	.rayCursor{margin:0px; padding:0px; cursor:pointer;}
	li{list-style-position:inside;}
	.formBloc{width:438px !important; width:440px; background-color:#fff; border:1px solid #ccc; float:center; padding:5px;}		
	#titreOnglet{ font-weight:bold; float:left; text-align:left; width:172px; height:19px;}
	#onglets{width:450px; margin-left:50px !important;  margin-left:-12px; background-color:#fff; height:19px;  background-repeat:no-repeat; background-image:url("$$_$$engine/centredecontact/img/venOn.gif");}
	.ongletTransaction input{margin:0px; padding:0px; margin-right:5px; margin-top:3px !important;  margin-top:-1px; float:left;}
	.ongletTransaction{width:400px; height:19px;}
	#ongetTransactionLabel{margin-top:2px; float:left;}
	#ongletTransaction-Location{font-weight:bold; float:left; text-align:left; width:100px; height:19px;}
	#ongletTransaction-Vente{font-weight:bold; float:left; text-align:left; width:100px; height:19px;}	
	#creAlerte {background-color:#E4EFF8;}
	#creAlerte input{margin-bottom:0px !important; margin-bottom:-2px;}
	#etatAlerte-a{position:relative; top:10px; border:1px solid red;}
	#creAlerte .radio{position:relative; top:3px !important; top:0px;}
	#creAlerte .button{background-image:url("$$_$$engine/centredecontact/img/locOn.gif"); border:1px solid #FF9400; font-weight:bold;}
	#creAlerte li{list-style-position:inside;}
	.gestError{font-size:12px; font-weight:bold; color:#d4000e; background-color:#EBCDC3; border:1px solid #d4000e; width:450px; padding:5px; margin-bottom:10px;}
	.formHelpCity{padding:3px;  width:426px; height:37px; border:1px solid #ccc; background-color:#FBE5CB; font-weight:bold;}	
	
	#helpCity input, #helpCity label {float: left}
	#helpCity div, #btCpList1{clear: both}
-->	
</style>

<script type="text/javascript">
<!--	

	var dragObject  = null;
	var mouseOffset = null;
	
	document.onmousemove = mouseMove;
	document.onmouseup   = mouseUp;
	
	function getMouseOffset(target, ev){
		ev = ev || window.event;
		var docPos    = getPosition(target);
		var mousePos  = mouseCoords(ev);
		return {x:mousePos.x - docPos.x, y:mousePos.y - docPos.y};
	}
	
	function getPosition(e){
		var left = 0;
		var top  = 0;
		while (e.offsetParent){
			left += e.offsetLeft;
			top  += e.offsetTop;
			e     = e.offsetParent;
		}
		left += e.offsetLeft;
		top  += e.offsetTop;
		return {x:left, y:top};
	}
	
	function mouseCoords(ev){
		if(ev.pageX || ev.pageY){
			return {x:ev.pageX, y:ev.pageY};
		}
		return {
			x:ev.clientX + document.body.scrollLeft - document.body.clientLeft,
			y:ev.clientY + document.body.scrollTop  - document.body.clientTop
		};
	}
	
	function mouseMove(ev){
		ev           = ev || window.event;
		var mousePos = mouseCoords(ev);
		if(dragObject){
			position(mousePos.x - mouseOffset.x,mousePos.y - mouseOffset.y);
			return false;
		}
	}

	function mouseUp(){
		if(dragObject){loadRing();}
		dragObject = null;
	}
	
	function makeDraggable(item){
		if(!item) return;
		item.onmousedown = function(ev){
			dragObject  = this;
			mouseOffset = getMouseOffset(this, ev);
			return false;
		}
	}
	
	var lastX = 0;
	function position(x,y) { 
		 var RayX = parseInt(document.getElementById('cursorRay').style.left);
     if(x && RayX){
     		deltaX = x - lastX;
     		if((RayX + deltaX > 5) &&(RayX + deltaX < 102)){
     			document.getElementById('cursorRay').style.left = RayX + deltaX + "px";
    			document.getElementById('couronneRayon').value = parseInt((RayX + deltaX)/2);
     		}
     		lastX = x;
     	}
   }

	$$REM$$
		function changeCpRay(a){
			if(a==1){
				document.onmousedown = position;
			}	
			else{
				document.onmousedown = false;
			}
		}
	$$END$$
-->	
</script>

<div style="margin-bottom:10px; width:450px; text-align:left; font-weight:bold;">&laquo;<a href="$$REP:0 field 1$$,dossiers.htm" style="font-weight:bold;"> Retour vers &quot;Mes Recherches&quot;</a> </div>

<div id="debugTxt"></div>
<a href="#" name="errMsgLink"></a>
<div id="errMsg" style="display:none;"></div><div id="gestError"></div>

<form name="formGestMandat" id="formGestMandat" method="post" style="padding:0px; margin:0px;">
	<input name="u" value="mandatvente:campagnemultiple" type="hidden" />
	<input name="page_ok" value="/$$REP:URI replace crealertes.htm dossiers.htm$$" type="hidden" />
	<input name="page_err" value="/$$REP:URI$$" type="hidden" />
	<input name="iduser" value="$$SESSION:IDUSER$$" type="hidden" />
	<input name="etatcampagne" value="a" type="hidden" />
	<input name="idclient" value="$$SESSION:IDCLENT$$" type="hidden" />
	<input name="listetypebien" id="listetypebien1" value="1" type="hidden" />
	<input name="step" id="step" value="0" type="hidden" />
	$$REM:20070111$$<input name="display" id="listetypebien1" value="groupe" type="hidden" />$$END$$
	<div id="onglets">	<div id="titreOnglet" style="margin:2px 0px -2px 2px;"> &nbsp;&nbsp;&nbsp;Mes nouvelles recherches </div>	</div>
<div id="contentAll" class="contentAll">  
	<div class="divContent" id="creAlerte">
		<!-- step 1 Start -->
		<div id="creAlerte-1" style="display:inline;">
			<div class="formBloc" style="min-height:140px; border-bottom:none;">	

				Pour cibler les biens désirés, <br />
				<li style="margin:5px 0px 5px 0px;"> Sélectionnez les villes concernées * : </li>

				<div class="formHelpCity">
					Afficher les villes autour du code postal 
					<input type="text" value="$$IMMOBC:AGENCECORE:CP$$" name="couronneCP" id="couronneCP" size="5" maxlength="5" onBlur="loadRing();"/> <br />
					<div style="float:left;">dans un rayon de</div>
					<div id="selectCursor" style="margin-top:-4px; float:left; vertical-align:middle; text-align:center; width:110px; height:20px;">
						<img id="cursorRay" src="$$_$$engine/centredecontact/img/locOn.gif" class="rayCursor" style="width:4px; height:10px; z-index:10; position:relative; left:10px; top:7px; float:left; border:1px outset #aaa;" />
						<img id="cursorWay" src="$$_$$engine/centredecontact/img/locOn.gif" style="z-index:5; position:relative; left:0px; top:0px; float:left; width:100px; height:3px; margin:0px; padding:0px; border-bottom:1px solid #ccc;" />	
						<script type="text/javascript">
						//<![CDATA[	
							makeDraggable(document.getElementById('cursorRay'));
						//]]>
						</script>	
					</div>
					<div style="float:left;">
						<input id="couronneRayon" style="background-color:#FBE5CB; text-align:center; border:none; padding:0px; padding-bottom:2px; margin:0px 2px 0px -1px; width:15px; font-size:11px; font-weight:bold;" name="couronneRayon" size="1" maxlength="2" type="text" value="$$INIT:FORM:COURONNERAYON=5$$$$FORM:COURONNERAYON$$">km <!--  &nbsp;  <span style="color:grey; font-size:10px;"> (max : 50 km) </span> -->
						&nbsp;	<input value="OK" onClick="loadRing();" type="button" class="button"/>
					</div>
				</div>

				<div id="listeCpProximite">
					<div id="gestErrorCouronne" style="padding:5px; font-weight: bold; color: rgb(212, 0, 14);"></div>
					<div id="helpCity" style="width:430px; padding-bottom:5px;"></div>
				</div>
			</div>	
			<div class="formBloc" style="border-top:none;>
				<li> Ou précisez les codes postaux des biens recherchés * : </li><br />
				<span id="listCp"><input name="LISTECP" id="LISTECP0" value="" size="5" type="text"></span> 
				<span id="listCp"><input name="LISTECP" id="LISTECP1" value="" size="5" type="text"></span> 
				<span id="listCp"><input name="LISTECP" id="LISTECP2" value="" size="5" type="text"></span> 
				<span id="listCp"><input name="LISTECP" id="LISTECP3" value="" size="5" type="text"></span> 
				<span id="listCp"><input name="LISTECP" id="LISTECP4" value="" size="5" type="text"></span> 
				<br /><span class="greyinfo">ex: $$IMMOBC:AGENCECORE:CP$$</span>
			</div>
			<br />
			<div class="formBloc">
				<li> Email utilisé pour le suivi de mes recherches : </li><br />
				Mon Email : <input id="emailcampagne" name="emailcampagne" value="$$FORM:EMAILCAMPAGNE$$$$IF0:FORM:EMAILCAMPAGNE$$$$MANDATVENTE:CLIENT:EMAILCLIENT$$$$END$$" type="text" size="30">*
			</div>
			<br />
			<input value="&raquo; Suite" type="button" onClick="stepCreAlerte(1);" class="button" style="float:right;">
		</div>		
		<!-- step 1 Stop -->
		
		<!-- div class="formBloc" style="text-align:right; border:none; background-color:none; margin:none; padding:none;">
		</div -->
		<input id="btnBack" value="&laquo; Retour" type="button" onClick="stepCreAlerte(0);" class="button" style="margin:0px !important; margin:8px; display:none;" />				 
		
		<!-- step 2 Start -->	
		<div id="creAlerte-2" style="display:none; border:1px solid #ccc;">
			<br />
			<div class="formBloc">
				<div class="ongletTransaction" style="width:430px;"> 
					$$BIF:TRANSACTIONS$$ <div style="float:left;">Type de transactions recherchées * : &nbsp; </div>  $$DO$$<div id="ongletTransaction-$$TRANSACTIONS:TYPETRANSACTION$$"><input type="checkbox" name="listetypetransac" id="listetypetransac-$$TRANSACTIONS:TYPETRANSACTION$$" value="$$TRANSACTIONS:IDTYPETRANSAC$$" checked="checked" onclick="getGroupeNom();" /><div id="ongetTransactionLabel"><label for="listetypetransac-$$TRANSACTIONS:TYPETRANSACTION$$">$$TRANSACTIONS:TYPETRANSACTION$$</label> </div></div>$$LOOP$$$$BFIN$$
				</div>				
				
				<br />
				<input type="radio" name="etatalerte" id="etatalerteW" value="W" checked="checked" onClick="displayAmount();" /> <label for="etatalerteW">Recevez gratuitement les contacts  15 jours après leur diffusion</label> <br />
				<input type="radio" name="etatalerte" id="etatalerte" value="a" onClick="displayAmount();" /> 
				<label for="etatalerte"> Contacts Chrono : <br /> &nbsp; &nbsp; &nbsp;  &nbsp;Recevez  le contact avant tous vos confrères en plaçant une enchère.</label>
				
				$$IF:MANDATVENTE:CLIENT:PRIME_RESTANT$$	
					<div style="color:red; font-weight:bold;">
						&nbsp; &nbsp; &nbsp;  &nbsp;$$MANDATVENTE:CLIENT:PRIME_RESTANT formatnumber 0$$ &euro; HT	offert$$MANDATVENTE:CLIENT:PRIME_RESTANT pluriel$$ pour découvrir notre option "Contacts Chrono". 
					</div>
				$$END$$
				
				<br />
				<div id="amount" style="display:none;">
				<p>
				Il vous suffit de fixer le montant maximum que vous êtes prêt à payer pour obtenir les contacts qualifiés souhaités et ce, dans la limite du budget que vous souhaitez y consacrer. <br />
				<br />
				<b>Vous êtes 1er 	:	 </b>Vous recevez en exclusivité le contact mandat pendant 3 jours. <br />
				<b>Vous êtes 2ème :  </b>Vous recevez le même contact mandat après 3 jours  <br />
				<b>Vous êtes 3ème :  </b>Vous recevez le contact mandat après 5 jours <br />
				</p>
				<b>
				Indiquez le montant maximum que vous souhaitez payer pour acquérir un contact correspondant à votre recherche : <br />
				Montant : <input id="montantalertes" name="montantalertes" size="3" value="$$INIT:FORM:MONTANTALERTES=0$$$$FORM:MONTANTALERTES$$" type="text">  *</b>
				<br />	<span style="color:grey;">Montant minimum : 10 &euro;</span>
				
				<br />
					
				</div>
				
				<!-- <br />Mes alertes seront associées au groupe : -->
				
				<input type="hidden" id="nomcampagne" name="nomcampagne" value="$$FORM:NOMCAMPAGNE$$$$IF0:FORM:NOMCAMPAGNE$$groupe$$MANDATVENTE:CLIENT:TOT_CAMPAGNE_ALL exec XX+1$$$$END$$"> 
				<!-- <div id="nomcampagneText" style="float:left; font-weight:bold"></div><br /> <br />
				<br />Mes alertes seront créées <input class="radio" name="etatalerte" value="a" id="etatalerte-a" $$IF=:a:FORM:ETATALERTE$$checked="checked"$$END$$$$IF0:FORM:ETATALERTE$$checked="checked"$$END$$ type="radio"><label for="etatalerte-a">actives</label> <input class="radio"  name="etatalerte" value="i" id="etatalerte-i" type="radio"$$IF=:i:FORM:ETATALERTE$$checked="checked"$$END$$><label for="etatalerte-i">inactives</label>
				-->
				
				<!-- input name="etatalerte" value="a" id="etatalerte-a" type="hidden" / -->
				
			</div>
			$$REM$$<!-- //// les CGV sont à accepter si prime == 0 et iscompteblanc == True -->$$END$$
			<div id="validation" class="formBloc"></div>
			
		</div>
		<!-- step 2 Stop -->
		
		<br />	<br /> * champs obligatoires
		</form>


<script type="text/javascript">
<!--

   $$IF:FORM:COURONNERAYON$$ 
   /* position cursor if reload with ray value posted */
   position($$FORM:COURONNERAYON$$);
   $$END$$

<!--#include absolute="/portail/pol/engine/centredecontact/javascript.htm"-->
	
	/* display/hide error message */
	function gestError(a){
		if(a){	
			document.getElementById('errMsg').style.display = 'inline';
			document.getElementById('errMsg').innerHTML = "<div class='gestError'>"+a+"</div>";
			document.location.href ="#errMsgLink";		
		}
		else{
			document.getElementById('errMsg').style.display = 'none';
			document.getElementById('errMsg').innerHTML = "<div class='gestError'></div>";			
		}	
	}
	/* display/hide amount option if premium "alerte" */ 
	function displayAmount(){
		for(i=0 ; i < document.formGestMandat.etatalerte.length ; i++){
			if(document.formGestMandat.etatalerte[i].checked == true && document.formGestMandat.etatalerte[i].value=="a"){
				document.getElementById('amount').style.display = "inline";
				document.getElementById('montantalertes').value = 10;
			}
			else{
					document.getElementById('amount').style.display = "none";
					document.getElementById('montantalertes').value = 0;
			}
		}
	}
		/* just a "0" before format if value < 10 */ 
	function dateString(a){
		if(parseInt(a)<10){a = "0"+a}
		return a;	
	}
	/* automatic name group with search type and date */
	function getGroupeNom(){
			var myDate = new Date();
			var groupeDate = myDate.valueOf();
			var groupeTransactions = "";
			var groupeCp;
			for(i=0 ; i < document.formGestMandat.LISTECP.length ; i++){
				if(document.formGestMandat.LISTECP[i].checked == true){(!groupeCp)?groupeCp = document.formGestMandat.LISTECP[i].value:false;}
				else if(document.formGestMandat.LISTECP[i].value != "" && document.formGestMandat.LISTECP[i].id.substring(0,7) == "LISTECP"){
					(!groupeCp)?groupeCp = document.formGestMandat.LISTECP[i].value:false;
				}
			}
			for(i=0; i < document.formGestMandat.listetypetransac.length ; i++){
				if(document.formGestMandat.listetypetransac[i].checked == true){groupeTransactions += ((groupeTransactions!="")?' et ':'') + document.formGestMandat.listetypetransac[i].id.replace('listetypetransac-','');}
			}
			if(groupeTransactions!=""){
				$$REM$$
				//document.getElementById('nomcampagneText').innerHTML = groupeTransactions+groupeCp+" "+"("+groupeDate+")";
				//document.getElementById('nomcampagne').value = groupeTransactions+groupeCp+" "+"n&#176;"+groupeDate;	
				$$END$$
				groupeDate = dateString(myDate.getDate());
				groupeDate += "/"+dateString(myDate.getMonth()+1);
				groupeDate += "/"+dateString(myDate.getFullYear());
				groupeDate += " "+dateString(myDate.getHours());
				groupeDate += ":"+dateString(myDate.getMinutes());
				groupeDate += ":"+dateString(myDate.getSeconds());
				document.getElementById('nomcampagne').value = groupeTransactions+", "	+	groupeDate;
				gestError();
			}
			else{
				gestError("S&eacute;lectionnez au moins un type de transaction");
			}
	}
	
	/* cgv acceptation if necessary or submit "alerte"	*/
	function gestValidationCGV(a){
		if(a == false){
			document.getElementById('validation').className ="";
			document.getElementById('validation').innerHTML = '<input value="Validez ces recherches" type="button" onClick="stepCreAlerte(2);" class="button"  style="float:right;" />';
		}
		else{
			var textFields = "";
			textFields += "<p><b>Pour valider votre demande, merci d\'accepter les conditions générales de vente qui suivent : </b></p>" ;
			textFields += '<input type="checkbox" name="accept_cgv" id="accept_cgv" value="YES" />' ;
			textFields += "<label for='accept_cgv'>	$$LG:CGV htmlencode$$	</label>";
			textFields += "<br /><br />Vous pouvez indiquer le montant maximum de vos d&eacute;penses mensuelles : " ;
			textFields += '<input type="text" size="3" name="plafondmensuel" id="plafondmensuel" value="300" />&euro; </p>' ;
			textFields += '<input style="float:right;" class="button" type="button" name="valider" value="Valider les CGV" onclick="postCGV()" /><br /><br />';
			
			document.getElementById('validation').innerHTML = textFields;
		}
	}
	/* post CGV acceptation */
	function postCGV(){
		var a ="";
		var b=""; 
		var errMsg = "";
		a = document.getElementById('accept_cgv');
		b = parseInt(document.getElementById('plafondmensuel').value);
		gestError();
		
		if((a.checked == true && a.value) && (isNaN(b) == false  && b > 0)){
				if(window.XMLHttpRequest){myFlew = new XMLHttpRequest(); }
				else if(window.ActiveXObject){myFlew = new ActiveXObject("Microsoft.XMLHTTP");} 
				var method   = "GET"; 
				var filename = "$$REP:0 field 1$$,cgvValid.htm"; 
				var uriElement = "";
				uriElement += "u=MANDATVENTE:UPDATECLIENT_PRESSIMMO";
				uriElement += "&page_ok="+filename;
				uriElement += "&page_err="+filename;
				uriElement += "&idagence=$$IMMOBC:AGENCECORE:IDAGENCE$$";
				uriElement += "&accept_cgv="+a.value; 			
				uriElement += "&plafondmensuel="+b; 
				
				var data = null; 
				if(uriElement != ""){data = uriElement;} 
				if(method == "GET" && data != null) { 
				   filename += "?"+data; 
				   data      = null; 
				} 
				myFlew.open(method, filename, true); 
				myFlew.onreadystatechange = function() { 
				   if(myFlew.readyState == 4) { 
				      
				      var myResult = myFlew.responseText; 
				      if(myResult == "okCGV"){gestValidationCGV(false);}
				      else{
								errMsg = "Une erreur est survenue. Merci de contacter votre service commercial <br />"+myResult;      	
				      	if(errMsg){gestError(errMsg);}
				      	document.getElementById('validation').innerHTML = myResult;
				      }
				   } 
				} 
				if(method == "POST"){myFlew.setRequestHeader("Content-type", "application/x-www-form-urlencoded");} 
				myFlew.send(data); 
			}
			else{
				if(a.checked == false){errMsg += "Merci de valider les Conditions G&eacute;n&eacute;rales de Ventes en cochant la case." }
				if(isNaN(b) || b<1){
						(errMsg !="")?errMsg+="<br />":null; 
						errMsg += "Merci de sp&eacute;cifier un montant maximum valide.";
				}
				if(errMsg){gestError(errMsg);}
			}
	}
	$$A:VALIDCGV=false$$
	
	$$IF:XDEV$$	<!-- test si prime null -->
		$$IF=:null:FORM:PRIME$$	$$A:MANDATVENTE:CLIENT:PRIME_RESTANT=$$	$$END$$
	$$END$$
		
	$$IF=:True:MANDATVENTE:IDENTIFICATION_PRESSIMMO:ISCOMPTEBLANC$$$$IF0:MANDATVENTE:CLIENT:PRIME_RESTANT$$
		$$A:VALIDCGV=true$$
	$$END$$$$END$$
	gestValidationCGV($$VALIDCGV$$);
	
	/* display select form step */
	function stepCreAlerte(a){
		var errMsg = "";
		var reCity = /^\d{5}$/;

		switch(a){
			case  0 :
				gestError();
				document.getElementById('step').value = 0;
				document.getElementById('creAlerte-1').style.display = 'inline';
				document.getElementById('creAlerte-2').style.display = 'none';
				document.getElementById('btnBack').style.display = 'none';
				if(document.getElementById('helpCity').innerHTML == ""){loadRing();}
				break;
			case 1 : 
				gestError();
				document.getElementById('step').value = 1;
				/* isOk type text email and type checkbox LISTECP */
				if(!document.getElementById('emailcampagne').value){errMsg += "Saisissez une adresse email. <br />";}
				var listecp = false;
				var cpValide = true;
				for(i=0 ; i < document.formGestMandat.LISTECP.length ; i++){
					if(document.formGestMandat.LISTECP[i].checked == true){listecp = true;}
					else if(document.formGestMandat.LISTECP[i].value != "" && document.formGestMandat.LISTECP[i].id.substring(0,7) == "LISTECP"){
						listecp = true;
						if(!reCity.test(document.formGestMandat.LISTECP[i].value) && document.formGestMandat.LISTECP[i].value != ""){cpValide = false}
					}
				}
				if(listecp == false){errMsg += "Choisissez au moins un code postal <br />";}
				if(!cpValide){errMsg += "Saisissez un code postal valide <br />"};
				
				if(errMsg == ""){
					gestError();		
					getGroupeNom();
					document.getElementById('creAlerte-1').style.display = 'none';
					document.getElementById('creAlerte-2').style.display = 'inline';
					document.getElementById('btnBack').style.display = 'inline';
					document.location.href ="#errMsgLink";

				}
				else{
					gestError(errMsg);	
				}
				break;				
			case 2 :
					gestError();
					/* isOk type checkbox transaction, type text email and amount */			
					if(!document.getElementById('montantalertes').value){errMsg += "Saisissez un montant d'enchère. <br /> ";}
					//if(document.getElementById('montantalertes').value && parseInt(document.getElementById('montantalertes').value) < 10){errMsg += "Saisissez un montant d'au moins 10 &euro; <br /> ";}
					if(!document.getElementById('nomcampagne').value){errMsg += "Saisissez le nom du groupe associé aux recherches <br />";}
					var transactionList  = false;
					for(i=0; i < document.formGestMandat.listetypetransac.length ; i++){
						if(document.formGestMandat.listetypetransac[i].checked == true){transactionList = true;}
					}
					if(transactionList == false){errMsg += "Choisissez au moins un type de transaction <br />";}
					if(errMsg == ""){
						gestError();	
						document.getElementById('formGestMandat').submit();
					}
					else{
						gestError(errMsg);	
					}			
				break;
		}
	}
	$$INIT:FORM:STEP=0$$
	stepCreAlerte($$FORM:STEP$$);
	
	/* load city list arround a first one with a dynamic ray */
	function loadRing(){
		var city = document.getElementById('couronneCP').value;
		var ray = parseInt(document.getElementById('couronneRayon').value);
		var reCity = /^\d{5}$/;
		var reRay = /^\d{1,2}$/;

		var myFlew = null; 
		var errMsg ="";
		gestError();	
		if(!reCity.test(city)){errMsg += "Vous devez saisir un code postal valide<br />";}	
		if(!reRay.test(ray) || ray < 1 || ray > 50){errMsg += "Vous devez saisir un rayon entre 1 et 50 km<br />"}	
		
		if(errMsg){
			gestError(errMsg);	
		}
		else{
			if(window.XMLHttpRequest){myFlew = new XMLHttpRequest(); }
			else if(window.ActiveXObject){myFlew = new ActiveXObject("Microsoft.XMLHTTP");} 
			var method   = "GET"; 
			var filename = "$$REP:0 field 1$$,listecp_ajx.htm"; 
			var uriElement = "rayon="+ray+"&ville="+city; 
			
			var data = null; 
			if(uriElement != ""){data = uriElement;} 
			if(method == "GET" && data != null) { 
			   filename += "?"+data; 
			   data      = null; 
			} 
			myFlew.open(method, filename, true); 
			myFlew.onreadystatechange = function() { 
			   if(myFlew.readyState == 4) { 
			      var divCityName="";
			      var myResult = myFlew.responseText.split(";"); 
			      for (i=0;i<myResult.length;i++){
							if(myResult[i].split('|')[1]){
							divCityName += '<div> <input type="checkbox" name="LISTECP" id="cp-'+myResult[i].split('|')[0]+'" value="'+myResult[i].split('|')[0]+'" '+((i==0)?' checked':'')+'/><label for="cp-'+myResult[i].split('|')[0]+'">'+ myResult[i].split('|')[1] + ' (' + myResult[i].split('|')[0] + ')' +'</label></div>';
							}
			      }
			      document.getElementById('helpCity').innerHTML = '<input type="button" value="Tout sélectionner" onClick="gestListCp(this.value);" id="btCpList0" /></a>';
			      document.getElementById('helpCity').innerHTML += divCityName;
			      document.getElementById('helpCity').innerHTML += '<div><input type="button" value="Tout sélectionner" onClick="gestListCp(this.value);" id="btCpList1" /><div></a>';
			   } 
			} 
			if(method == "POST"){myFlew.setRequestHeader("Content-type", "application/x-www-form-urlencoded");} 
			myFlew.send(data); 	
		}
	}	
	
	function gestListCp(a){
		var libelle = a;		
		
		if (document.formGestMandat.LISTECP.length){
			for(i = 0 ; i < document.formGestMandat.LISTECP.length ; i++){
				document.formGestMandat.LISTECP[i].checked = (libelle=="Tout sélectionner")?true:false;
			}
		document.getElementById('btCpList0').value = (libelle=="Tout sélectionner")?"Tout désélectionner":"Tout sélectionner";
		document.getElementById('btCpList1').value = (libelle=="Tout sélectionner")?"Tout désélectionner":"Tout sélectionner";
		}				
	}
-->	
</script>

<!--#include absolute="/portail/pol/engine/centredecontact/bas.htm"-->
