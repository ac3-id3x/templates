<script type="text/javascript">

function isInt(myNum) {
	var myMod = myNum % 1;
	 if (myMod == 0) {
                 return true;
         } else {
                 return false;
         }
}


function gestError(a){
	if(a){	
		document.getElementById('errMsg').style.display = 'inline';
		document.getElementById('errMsg').innerHTML = "<span>"+a+"</span>";
	}else{
		document.getElementById('errMsg').style.display = 'none';		
	}	
}

/* display/hide amount option if premium "alerte" */ 
function displayAmount(o){
	if(o.value=="a"){
		if(o.checked){
			document.getElementById('amount').style.display = "inline";
			document.getElementById('montantalertes').value = 10;
		}
	}else{
		document.getElementById('amount').style.display = "none";
		document.getElementById('montantalertes').value = 0;
	}	
}	
	
var modeSelect = 0;
$$IF:FORM:COURONNERAYON$$ 
   /* position cursor if reload with ray value posted */
   $$IF!:2$3:FORM:STEP$$
 			position($$FORM:COURONNERAYON$$);
 	 $$END$$
$$END$$

<!--#include absolute="/portail/pol/engine/centredecontact/javascript.htm"-->
	
/* just a "0" before format if value < 10 */ 
function dateString(a){
		if(parseInt(a)<10){a = "0"+a}
		return a;	
}
	
/* automatic name group with search type and date */
function getGroupeNom(){
	var myDate = new Date();
	var groupeDate = myDate.valueOf();
	var groupeTransactions = "";
	var groupeCp;
	var nomcampagne = document.getElementById('nomcampagne');
	
	var myform = document.formGestMandat;
		for(i=0 ; i <myform.listecp.length ; i++){
				if(myform.listecp[i].checked == true){(!groupeCp)?groupeCp =myform.listecp[i].value:false;}
				else if(myform.listecp[i].value != "" &&myform.listecp[i].id.substring(0,7) == "listecp"){
					(!groupeCp)?groupeCp =myform.listecp[i].value:false;
				}
		}
		for(i=0; i <myform.listetypetransac.length ; i++){
			if(myform.listetypetransac[i].checked == true){groupeTransactions += ((groupeTransactions!="")?' et ':'') + myform.listetypetransac[i].id.replace('listetypetransac-','');}
		}
		if(groupeTransactions!=""){
			groupeDate = dateString(myDate.getDate());
			groupeDate += "/"+dateString(myDate.getMonth()+1);
			groupeDate += "/"+dateString(myDate.getFullYear());
			groupeDate += " "+dateString(myDate.getHours());
			groupeDate += ":"+dateString(myDate.getMinutes());
			groupeDate += ":"+dateString(myDate.getSeconds());
			nomcampagne.value = groupeTransactions+", "	+	groupeDate;
		}			
	}
	
	
	
	/* display select form step v2 by sakio */
	function stepCreAlerte2(step){
		var errMsg = "";
			gestError(errMsg);
		if(step == 1){
			
			var reCity = /^\d{5}$/;
			var myform = document.formGestMandat;
			var city = document.getElementById('couronneCP').value;
		  var helpCity = document.getElementById('helpCity');
			var listecp = false;
			var cpValide = true;
		
			for(i=0 ; i < myform.listecp.length ; i++){
				if (myform.listecp[i].getAttribute("type")=="checkbox") {
					if(myform.listecp[i].checked == true){
						cpValide = false;
						listecp = true;
					}
				}
				
				if (myform.listecp[i].getAttribute("type")=="text") {
				if(myform.listecp[i].value != ""){
					if(isInt(myform.listecp[i].value)){
						if(myform.listecp[i].value.length == 5){
							cpValide = false;
							listecp = true;
						}
					}
				}
			}
			}
						
		if(city != ""){
			if(isInt(city)){
				if(city.length == 5){
					cpValide = false;
					listecp = true;
				}
			}
		}
		

			if(listecp == false){errMsg += "Choisissez au moins un code postal <br />";}
			if(cpValide == true){errMsg += "Saisissez un code postal valide <br />"};
		
			if(errMsg){
				gestError(errMsg);	
				helpCity.innerHTML = "";
				return false;
			}else {
				return true;	
			}
		}
		if(step == 2){
			getGroupeNom();	
			
			var etatalerte = document.forms['formGestMandat'].elements['etatalerte'];
			var listetypetransac = document.forms['formGestMandat'].elements['listetypetransac'];
			var listetypetransac_choice = 0; 
			var montantalertes = document.getElementById('montantalertes');
			
			for(var i = 0; i < etatalerte.length; i++) {
				if((etatalerte[i].checked == true)&&(etatalerte[i].value == "a")) {
					if (montantalertes.value < 10){
						errMsg += "Le montant minimum de l'option Contacts Chrono doit être supérieur à 10 &euro; <br />";
					}
				}
			}
								
			for(var i = 0; i < listetypetransac.length; i++) {
				if(listetypetransac[i].checked == true) {
					listetypetransac_choice = 1;
				}
			}			
						
		
		
			if(listetypetransac_choice == 0){
				errMsg += "Au moins un type de transaction doit être sélectionné <br />";			
			}

			if(errMsg){
				gestError(errMsg);	
			
				return false;
			}else {
				return true;	
			}
			
		}
		if(step == 3){
			 var emailcampagne = document.getElementById('emailcampagne');
			 if(emailcampagne.value == ""){
			 		errMsg += "Indiquer un email valide associé à cette recherche <br />";	
			 }
		}
		if(errMsg){
				gestError(errMsg);	
			
				return false;
			}else {
				return true;	
			}
		
	}
	
	

	
	function gestListCp(){
		var imgs=["http://www.selogerpro.com"+"$$_$$i/dyn/btntoutselectionner.png","http://www.selogerpro.com"+"$$_$$i/dyn/btntoutdeselectionner.png"]
		var img0 = document.getElementById('imgCpList0');
		var img1 = document.getElementById('imgCpList1');

		modeSelect = Math.abs(modeSelect-1);
		
		if (modeSelect == 1)
		{
			img0.style.width=154;
			img1.style.width=154;
		}else{
			img0.style.width=136;
			img1.style.width=136;
		}
		
		if (img0.tagName=="SPAN") // est vrai sous ie
		{
			img0.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+imgs[modeSelect]+"', sizingMethod='scale');";
			img1.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+imgs[modeSelect]+"', sizingMethod='scale');";
		}
		else {
			img0.src=imgs[modeSelect];
			img1.src=imgs[modeSelect];
		}
		
		if (document.formGestMandat.listecp.length){
			for(i = 0 ; i < document.formGestMandat.listecp.length ; i++){
				document.formGestMandat.listecp[i].checked = (modeSelect==1)?true:false;
			}
		}
	}

	function getListCityBtnCode(nbr,issel) {
		return  '<div id=cplistsel'+nbr+'><img src="$$_$$i/dyn/btntout'+((issel==1)?'de':'')+'selectionner.png" /></div>';
	}

	/* load city list arround a first one with a dynamic ray */
	function loadRing(){
		var city = document.getElementById('couronneCP').value;
		var helpCity = document.getElementById('helpCity');
		var ray = parseInt(document.getElementById('couronneRayon').value);
		var reCity = /^\d{5}$/;
		var reRay = /^\d{1,2}$/;
		var myform = document.formGestMandat;
		
		var myFlew = null; 
		var errMsg ="";
		gestError();	
		var okc1 = 0;
		var listecp = false;
		var cpValide = true;
	
		for(i=0 ; i < myform.listecp.length ; i++){
			if (myform.listecp[i].getAttribute("type")=="checkbox") {
				if(myform.listecp[i].checked == true){
					cpValide = false;
					listecp = true;
				}
			}
			
			if (myform.listecp[i].getAttribute("type")=="text") {
				if(myform.listecp[i].value != ""){
					if(isInt(myform.listecp[i].value)){
						if(myform.listecp[i].value.length == 5){
							cpValide = false;
							listecp = true;
							okc1 = 1;
						}
					}
				}
			}
			
		}
		if(city != ""){
			if(isInt(city)){
				if(city.length == 5){
					cpValide = false;
					listecp = true;
				}
			}
		}
		
		if(listecp == false){errMsg += "Choisissez au moins un code postal <br />";}
		if(cpValide == true){errMsg += "Saisissez un code postal valide <br />"};
		
		
		if(!reRay.test(ray) || ray < 1 || ray > 50){
			errMsg += "Vous devez saisir un rayon entre 1 et 50 km<br />"
		}	
	
		if(errMsg){
			gestError(errMsg);	
			helpCity.innerHTML = "";
		}
		else{			
			if((okc1 == 0)&&(city != "")){
				if(window.XMLHttpRequest){myFlew = new XMLHttpRequest(); }
				else if(window.ActiveXObject){myFlew = new ActiveXObject("Microsoft.XMLHTTP");} 
				var method   = "GET"; 
				var filename = "$$REP:0 field 1$$,listecp_ajx.htm"; 
				var uriElement = "rayon="+ray+"&ville="+city; 
				
				var data = null; 
				if(uriElement != ""){data = uriElement;} 
				if(method == "GET" && data != null) { 
				   filename += "?"+data; 
				   data      = null; 
				} 
				myFlew.open(method, filename, true); 
				myFlew.onreadystatechange = function() { 
				   if(myFlew.readyState == 4) { 
				      var divCityName="";
				      var myResult = myFlew.responseText.split(";"); 
				      for (i=0;i<myResult.length;i++){
								if(myResult[i].split('|')[1]){
								divCityName += '<div class=hpccnt><label for="cp-'+myResult[i].split('|')[0]+'"><input type="checkbox" name="listecp" id="cp-'+myResult[i].split('|')[0]+'" value="'+myResult[i].split('|')[0]+'" '+((i==0)?' checked':'')+'/>'+ myResult[i].split('|')[1] + ' (' + myResult[i].split('|')[0] + ')' +'</label></div>';
								}
				      }
				     
				      helpCity.innerHTML=
				      '<h4>Résultat de la recherche :</h4><div id=sellist0><img id="imgCpList0" src="$$_$$i/dyn/btntoutselectionner.png" /></div>'
				      +divCityName
				      +'<div id=sellist1><img id="imgCpList1" src="$$_$$i/dyn/btntoutselectionner.png" /><div>';
	
				      document.getElementById('sellist0').onclick=gestListCp;
				      document.getElementById('sellist1').onclick=gestListCp;
		
				   } 
				} 
				if(method == "POST"){myFlew.setRequestHeader("Content-type", "application/x-www-form-urlencoded");} 
				myFlew.send(data); 
			}else{ helpCity.innerHTML = "";}
		}
		$$IF:MODEDEV$$setTimeout("initSize('test')",10000);$$END$$
		
	}	
</script>