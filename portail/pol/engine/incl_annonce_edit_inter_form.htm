$$INCL:AUTH.HTM$$
$$A:IMGCNXWEB=@@FORM:IMGCNXWEB@@$$
$$E:SLPRO:ANNONCE:~idannonce:REP:1:ALIAS:ANNONCE$$

<script type="text/javascript">
	lang_toggle( 'libelle|prox|descriptif|situation', 'languesxml', 'en', 'libelle|prox|descriptif|situation' );
	

</script>

$$REM$$
<script type="text/javascript">
<!--

function lang_put_texte_langue_section3( iddom, va, idlang, idsection ) {
//=================================================================

	var elt = lang_get_element( iddom );

	var nouveautexte = null;
	
	if( elt ) {
		var texte = elt.value;
		
		var indexlang = lang_get_index_text( texte, idlang );
		
		
		if( indexlang ) {
		
			var textlang = texte.substring( indexlang[0], indexlang[1] );
		
			// La langue <idlang> </idlang> existe déjà, cherchons la section (descr, prox, ...)
			var indexsection = lang_get_index_text( textlang, idsection );
			
			if( indexsection ) {
				alert("La section existe déjà");
				// La section existe déjà, il faut faire du remplacement. Vivent les indexes.
				nouveautexte = texte.substring( 0, indexlang[0] + indexsection[0] ) + va + texte.substring( indexlang[0] + indexsection[1] );
				
			} else {
				alert("La section n'existe pas");
				// La section n'existe pas dans la langue, il faut l'ajouter en fin de langue.
				// Seul l'index de fin de langue nous intéresse.
				if( va && va.length > 0 ) {
					nouveautexte = texte.substring( 0, indexlang[1] ) + "<" + idsection + ">" + va + "</" + idsection + ">" + texte.substring( indexlang[1] );
				} else {
					nouveautexte = texte.substring( 0, indexlang[1] ) + texte.substring( indexlang[1] );
				}
			}
		} else {
			// il faut ajouter au texte existant un composite fait de idlang & idsection
			if( va && va.length > 0 ) {
				nouveautexte = texte + "<" + idlang + "><" + idsection + ">" + va + "</" + idsection + "></" + idlang + ">";
			}
		}
		
		if( nouveautexte ) {
			elt.value = nouveautexte;
		}
	}
}



function lang_update( iddestination ) {
//=============================================================
	var o = document.getElementById('debug');
	var i;

	
	if( iddestination ) {
			var texte = lang_get_field( iddestination );
			
			if( texte == null ) {
				texte = "";
			}
	
			var elt_id = lang_get_element( iddestination + "_id" );
			if( elt_id ) {
				var id = elt_id.value;
				var index = id.split( "|", 3 );
				// [0] = iddom, [1] = idlang, [2] = idsection
				if(o){o.innerHTML = index[0]+"_"+index[1]+"_"+index[2]};
				if( index.length == 3 ) {
					lang_put_texte_langue_section3( index[0], texte, index[1], index[2] );
			}
			
			
			}
	
	}

}	
	
	
//-->
</script>$$END$$

<input type="hidden" name="languesxml" id="languesxml" value="$$ANNONCE:LANGUESXML htmlencode$$" />

<table>
	<tr>

		<td>Langue sélectionnée : <img id="libelle_flag" src="$$IMGCNXWEB$$uk.gif" width="18" height="12" title="" /></td>
		<td>Cliquez pour changer : $$INCL:CHOIX_LANGUE.HTM$$</td>
	</tr>
	
	<tr>
		<td valign="top">
			Libelle :<br />
			<input type="hidden" name="libelle_id" id="libelle_id" value="" />
			<input type="text" name="libelle" id="libelle" value="" size="32" maxlength="64" title="Ex. : studio / Villa 6 pièces..." onblur="javascript:lang_update('libelle');" />
			<br /><font class="legende">Ex.: studio/Villa 6 pièces...</font>
		</td><td>
			Proximité :<img id="prox_flag" src="$$IMGCNXWEB$$00.gif" width="1" height="1" title="" /><br />
			<input type="hidden" name="prox_id" id="prox_id" value="" />
			<input type="text" name="prox" id="prox" value="" size="32" maxlength="64" title="Proximité" onblur="javascript:lang_update('prox');" />
			<br /><font class="legende">Ex.: Gare, centre ville, RER, ...</font>
		</td>
	</tr>
	
	<tr>
		<td valign="top" colspan="2">
			Situation :<img id="situation_flag" src="$$IMGCNXWEB$$00.gif" width="1" height="1" title="" /><br />
			<input type="hidden" name="titre_situation" value="Situation Langue" />
			<input type="hidden" name="situation_id" id="situation_id" value="" />
			<textarea name="situation" id="situation" rows="4" cols="80" maxlength="1024" title="Situation du bien" onblur="javascript:lang_update('situation');"></textarea>
			<input type="hidden" name="situation" id="situation" title="Situation du bien" >
		</td>
	</tr><tr>
		<td valign="top" colspan="2">
			Descriptif :<img id="descriptif_flag" src="$$IMGCNXWEB$$00.gif" width="1" height="1" title="" /><br />
			<input type="hidden" name="titre_descriptif" value="Descriptif Langue" />
			<input type="hidden" name="descriptif_id" id="descriptif_id" value="" />
			<textarea name="descriptif" id="descriptif" rows="10" cols="80" maxlength="8192" title="Descriptif du bien" onblur="javascript:lang_update('descriptif');"></textarea>
			<input type="hidden" name="len_descriptif_fr" value="8192" />
$$REM$$			<a href="javascript:alert(document.getElementById('languesxml').value);">languesxml</a>
			<div id="debug">...</div>$$END$$
		</td>
	</tr>


<!--  ...................................... INTER - End - GESLANG - Begin -->
	$$B:IMMOBC:LANGUESPARLEES:VAL:AUTH_CHECK*LOGIN_IDAGENCE:REP:1:1:ALIAS:LANGUESPARLEES$$ 
	$$BIF:LANGUESPARLEES$$
	
		<tr>
			<td valign="top" colspan="2">
				<strong>Langues parlées du ou des contact(s) de l'agence pour cette annonce :</strong><br /><br />
				<!-- $$FORM:XMLL_IDLANGUESPARLEES_MODIF$$ -->
					<div id="leslanguesparlees">
					$$DO:1:99$$
					$$IF=:1:LANGUESPARLEES:CHECKED$$
					<input type="checkbox" name="xmll_idlanguesparlees_modif" id="xmll_idlanguesparlees_modif_$$LANGUESPARLEES:I$$" disabled="disabled" checked="checked" value="$$LANGUESPARLEES:CODEISO$$" />$$LANGUESPARLEES:LIBELLE $$&nbsp;
					$$END$$
					$$LOOP$$
					</div>
			</td>
		</tr>
	$$BFIN$$

<!--  ...................................... GESTLANG - End - Nego - Begin -->
</table>


